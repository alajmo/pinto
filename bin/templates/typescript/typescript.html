
<span class="Special">import</span><span class="Normal"> <span class="Function">{<span class="typescriptBlock">promisify</span><span class="Function">}<span class="Normal"> <span class="Special">from</span><span class="Normal"> <span class="Constant">'util'</span><span class="Normal">;
<span class="Special">import</span><span class="Normal"> <span class="Function">{<span class="typescriptBlock">Duplex, Writable, Readable</span><span class="Function">}<span class="Normal"> <span class="Special">from</span><span class="Normal"> <span class="Constant">'stream'</span><span class="Normal">;
<span class="Special">import</span><span class="Normal"> <span class="Function">{<span class="typescriptBlock">ReadStream</span><span class="Function">}<span class="Normal"> <span class="Special">from</span><span class="Normal"> <span class="Constant">'fs'</span><span class="Normal">;
<span class="Special">import</span><span class="Normal"> <span class="Function">{<span class="Type">URL</span><span class="typescriptBlock">, </span><span class="Type">URLSearchParams</span><span class="Function">}<span class="Normal"> <span class="Special">from</span><span class="Normal"> <span class="Constant">'url'</span><span class="Normal">;
<span class="Special">import</span><span class="Normal"> <span class="Function">{<span class="typescriptBlock">Socket</span><span class="Function">}<span class="Normal"> <span class="Special">from</span><span class="Normal"> <span class="Constant">'net'</span><span class="Normal">;
<span class="Special">import</span><span class="Normal"> <span class="Function">{<span class="typescriptBlock">SecureContextOptions</span><span class="Function">}<span class="Normal"> <span class="Special">from</span><span class="Normal"> <span class="Constant">'tls'</span><span class="Normal">;
<span class="Special">import</span><span class="Normal"> http </span><span class="typescriptAssign">=<span class="Normal"> require(</span><span class="Constant">'http'</span><span class="Normal">);</span>
<span class="Special">import</span><span class="Normal"> <span class="Function">{<span class="typescriptBlock">ClientRequest, RequestOptions, IncomingMessage, ServerResponse, request </span><span class="Special">as</span><span class="typescriptBlock"> <span class="Normal">httpRequest</span><span class="Function">}<span class="Normal"> <span class="Special">from</span><span class="Normal"> <span class="Constant">'http'</span><span class="Normal">;
<span class="Special">import</span><span class="Normal"> https </span><span class="typescriptAssign">=<span class="Normal"> require(</span><span class="Constant">'https'</span><span class="Normal">);</span>
<span class="Special">import</span><span class="Normal"> timer, </span><span class="Function">{<span class="typescriptBlock">ClientRequestWithTimings, Timings, IncomingMessageWithTimings</span><span class="Function">}<span class="Normal"> <span class="Special">from</span><span class="Normal"> <span class="Constant">'@szmarczak/http-timer'</span><span class="Normal">;
</span>
<span class="Statement">type</span><span class="Operator"> <span class="Normal">HttpRequestFunction </span><span class="Operator">=<span class="Normal"> <span class="Statement">typeof</span><span class="Normal"> httpRequest;</span>
<span class="Statement">type</span><span class="Operator"> <span class="Normal">Error </span><span class="Operator">=<span class="Normal"> NodeJS.ErrnoException;

const </span><span class="typescriptVariableDeclaration">kRequest</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'request'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kResponse</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'response'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kResponseSize</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'responseSize'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kDownloadedSize</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'downloadedSize'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kBodySize</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'bodySize'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kUploadedSize</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'uploadedSize'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kServerResponsesPiped</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'serverResponsesPiped'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kUnproxyEvents</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'unproxyEvents'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kIsFromCache</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'isFromCache'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kCancelTimeouts</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'cancelTimeouts'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kStartedReading</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'startedReading'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kStopReading</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'stopReading'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kTriggerRead</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'triggerRead'</span><span class="Normal">);
const </span><span class="typescriptVariableDeclaration">kBody</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'body'</span><span class="Normal">);</span>
<span class="Special">export</span><span class="Normal"> const </span><span class="typescriptVariableDeclaration">kIsNormalizedAlready</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">Symbol</span><span class="Normal">(<span class="Constant">'isNormalizedAlready'</span><span class="Normal">);

const </span><span class="typescriptVariableDeclaration">supportsBrotli</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> is</span><span class="typescriptDotNotation">.<span class="Normal">string((</span><span class="Type">process</span><span class="typescriptDotNotation">.<span class="typescriptParenExp">versions </span><span class="Special">as</span><span class="typescriptParenExp"> <span class="Type">any</span><span class="Normal">)<span class="typescriptFuncCallArg">.brotli</span><span class="Normal">);
</span>
<span class="Special">export</span><span class="Normal"> <span class="Statement">interface</span><span class="Normal"> <span class="Function">Agents</span><span class="Normal"> <span class="Function">{
<span class="typescriptObjectType">	<span class="Function">http</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">http.Agent</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">https</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">https.Agent</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">http2</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">unknown</span><span class="Statement">;
<span class="Function">}
<span class="Normal">
<span class="Special">export</span><span class="Normal"> const </span><span class="typescriptVariableDeclaration">withoutBody</span><span class="typescriptTypeAnnotation">:<span class="Normal"> ReadonlySet</span><span class="typescriptTypeBrackets"><<span class="Type">string</span><span class="typescriptTypeBrackets">><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> new </span><span class="Type">Set</span><span class="Normal">(<span class="Function">[<span class="Constant">'GET'</span><span class="typescriptArray">, </span><span class="Constant">'HEAD'</span><span class="Function">]<span class="Normal">);
</span>
<span class="Special">export</span><span class="Normal"> <span class="Statement">interface</span><span class="Normal"> <span class="Function">ToughCookieJar</span><span class="Normal"> <span class="Function">{
<span class="typescriptObjectType">	<span class="Function">getCookieString</span><span class="Normal">(<span class="PreProc">currentUrl</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">string</span><span class="Operator">,<span class="PreProc"> options</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Function">{<span class="typescriptProperty">[<span class="Function">key</span><span class="typescriptTypeAnnotation">:<span class="typescriptComputedMember"> <span class="Type">string</span><span class="typescriptProperty">]<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">unknown</span><span class="Function">}<span class="Operator">,<span class="PreProc"> cb</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">(<span class="Special">err</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">Error</span><span class="Special"> <span class="Operator">|<span class="Special"> <span class="Type">null</span><span class="Operator">,<span class="Special"> cookies</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Type">string</span><span class="Normal">) </span><span class="Function">=></span><span class="PreProc"> <span class="Type">void</span><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">void</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">getCookieString</span><span class="Normal">(<span class="PreProc">url</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">string</span><span class="Operator">,<span class="PreProc"> callback</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">(<span class="Special">error</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">Error</span><span class="Special"> <span class="Operator">|<span class="Special"> <span class="Type">null</span><span class="Operator">,<span class="Special"> cookieHeader</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Type">string</span><span class="Normal">) </span><span class="Function">=></span><span class="PreProc"> <span class="Type">void</span><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">void</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">setCookie</span><span class="Normal">(<span class="PreProc">cookieOrString</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">unknown</span><span class="Operator">,<span class="PreProc"> currentUrl</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">string</span><span class="Operator">,<span class="PreProc"> options</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Function">{<span class="typescriptProperty">[<span class="Function">key</span><span class="typescriptTypeAnnotation">:<span class="typescriptComputedMember"> <span class="Type">string</span><span class="typescriptProperty">]<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">unknown</span><span class="Function">}<span class="Operator">,<span class="PreProc"> cb</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">(<span class="Special">err</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">Error</span><span class="Special"> <span class="Operator">|<span class="Special"> <span class="Type">null</span><span class="Operator">,<span class="Special"> cookie</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Type">unknown</span><span class="Normal">) </span><span class="Function">=></span><span class="PreProc"> <span class="Type">void</span><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">void</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">setCookie</span><span class="Normal">(<span class="PreProc">rawCookie</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">string</span><span class="Operator">,<span class="PreProc"> url</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">string</span><span class="Operator">,<span class="PreProc"> callback</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">(<span class="Special">error</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">Error</span><span class="Special"> <span class="Operator">|<span class="Special"> <span class="Type">null</span><span class="Operator">,<span class="Special"> result</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Type">unknown</span><span class="Normal">) </span><span class="Function">=></span><span class="PreProc"> <span class="Type">void</span><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">void</span><span class="Statement">;
<span class="Function">}
<span class="Normal">
<span class="Special">export</span><span class="Normal"> <span class="Statement">interface</span><span class="Normal"> <span class="Function">PromiseCookieJar</span><span class="Normal"> <span class="Function">{
<span class="typescriptObjectType">	<span class="Function">getCookieString</span><span class="Normal">(<span class="PreProc">url</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">string</span><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Promise</span><span class="typescriptTypeBrackets"><<span class="Type">string</span><span class="typescriptTypeBrackets">><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">setCookie</span><span class="Normal">(<span class="PreProc">rawCookie</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">string</span><span class="Operator">,<span class="PreProc"> url</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">string</span><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Promise</span><span class="typescriptTypeBrackets"><<span class="Type">unknown</span><span class="typescriptTypeBrackets">><span class="Statement">;
<span class="Function">}
<span class="Normal">
<span class="Special">export</span><span class="Normal"> <span class="Statement">type</span><span class="Operator"> <span class="Normal">Method </span><span class="Operator">=
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'GET'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'POST'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'PUT'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'PATCH'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'HEAD'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'DELETE'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'OPTIONS'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'TRACE'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'get'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'post'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'put'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'patch'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'head'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'delete'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'options'</span>
<span class="Normal">	<span class="Operator">|<span class="Normal"> <span class="Constant">'trace'</span><span class="Normal">;
</span>
<span class="Statement">type</span><span class="Operator"> <span class="Normal">Promisable</span><span class="typescriptTypeBrackets"><<span class="Normal">T<span class="typescriptTypeBrackets">><span class="Normal"> <span class="Operator">=<span class="Normal"> T </span><span class="Operator">|<span class="Normal"> Promise</span><span class="typescriptTypeBrackets"><<span class="Normal">T<span class="typescriptTypeBrackets">><span class="Normal">;
</span>
<span class="Special">export</span><span class="Normal"> <span class="Statement">type</span><span class="Operator"> <span class="Normal">InitHook </span><span class="Operator">=<span class="Normal"> (</span><span class="Special">options</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">Options) </span><span class="Function">=></span><span class="Normal"> Promisable</span><span class="typescriptTypeBrackets"><<span class="Type">void</span><span class="typescriptTypeBrackets">><span class="Normal">;
<span class="Special">export</span><span class="Normal"> <span class="Statement">type</span><span class="Operator"> <span class="Normal">BeforeRequestHook </span><span class="Operator">=<span class="Normal"> (</span><span class="Special">options</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">NormalizedOptions) </span><span class="Function">=></span><span class="Normal"> Promisable</span><span class="typescriptTypeBrackets"><<span class="Type">void</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Normal">Response</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Normal">ResponseLike</span><span class="typescriptTypeBrackets">><span class="Normal">;
<span class="Special">export</span><span class="Normal"> <span class="Statement">type</span><span class="Operator"> <span class="Normal">BeforeRedirectHook </span><span class="Operator">=<span class="Normal"> (</span><span class="Special">options</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">NormalizedOptions</span><span class="Operator">,<span class="Special"> response</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">Response) </span><span class="Function">=></span><span class="Normal"> Promisable</span><span class="typescriptTypeBrackets"><<span class="Type">void</span><span class="typescriptTypeBrackets">><span class="Normal">;
<span class="Special">export</span><span class="Normal"> <span class="Statement">type</span><span class="Operator"> <span class="Normal">BeforeErrorHook </span><span class="Operator">=<span class="Normal"> (</span><span class="Special">error</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">RequestError) </span><span class="Function">=></span><span class="Normal"> Promisable</span><span class="typescriptTypeBrackets"><<span class="Normal">RequestError</span><span class="typescriptTypeBrackets">><span class="Normal">;
</span>
<span class="Special">export</span><span class="Normal"> <span class="Statement">interface</span><span class="Normal"> <span class="Function">Hooks</span><span class="Normal"> <span class="Function">{
<span class="typescriptObjectType">	<span class="Function">init</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">InitHook</span><span class="typescriptTypeBracket">[]</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">beforeRequest</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">BeforeRequestHook</span><span class="typescriptTypeBracket">[]</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">beforeRedirect</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">BeforeRedirectHook</span><span class="typescriptTypeBracket">[]</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">beforeError</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">BeforeErrorHook</span><span class="typescriptTypeBracket">[]</span><span class="Statement">;
<span class="Function">}
<span class="Normal">
<span class="Special">export</span><span class="Normal"> <span class="Statement">type</span><span class="Operator"> <span class="Normal">HookEvent </span><span class="Operator">=<span class="Normal"> <span class="Constant">'init'</span><span class="Normal"> <span class="Operator">|<span class="Normal"> <span class="Constant">'beforeRequest'</span><span class="Normal"> <span class="Operator">|<span class="Normal"> <span class="Constant">'beforeRedirect'</span><span class="Normal"> <span class="Operator">|<span class="Normal"> <span class="Constant">'beforeError'</span><span class="Normal">;
</span>
<span class="Special">export</span><span class="Normal"> const </span><span class="typescriptVariableDeclaration">knownHookEvents</span><span class="typescriptTypeAnnotation">:<span class="Normal"> HookEvent</span><span class="typescriptTypeBracket">[]</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Function">[<span class="Constant">'init'</span><span class="typescriptArray">, </span><span class="Constant">'beforeRequest'</span><span class="typescriptArray">, </span><span class="Constant">'beforeRedirect'</span><span class="typescriptArray">, </span><span class="Constant">'beforeError'</span><span class="Function">]<span class="Normal">;
</span>
<span class="Statement">type</span><span class="Operator"> <span class="Normal">AcceptableResponse </span><span class="Operator">=<span class="Normal"> IncomingMessage </span><span class="Operator">|<span class="Normal"> ResponseLike;</span>
<span class="Statement">type</span><span class="Operator"> <span class="Normal">AcceptableRequestResult </span><span class="Operator">=<span class="Normal"> AcceptableResponse </span><span class="Operator">|<span class="Normal"> ClientRequest </span><span class="Operator">|<span class="Normal"> Promise</span><span class="typescriptTypeBrackets"><<span class="Normal">AcceptableResponse</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Normal">ClientRequest</span><span class="typescriptTypeBrackets">><span class="Normal"> <span class="Operator">|<span class="Normal"> <span class="Type">undefined</span><span class="Normal">;
</span>
<span class="Special">export</span><span class="Normal"> <span class="Statement">type</span><span class="Operator"> <span class="Normal">RequestFunction </span><span class="Operator">=<span class="Normal"> (</span><span class="Special">url</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">URL</span><span class="Operator">,<span class="Special"> options</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">RequestOptions</span><span class="Operator">,<span class="Special"> callback</span><span class="PreProc">?<span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">(<span class="Special">response</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">AcceptableResponse) </span><span class="Function">=></span><span class="Special"> <span class="Type">void</span><span class="Normal">) </span><span class="Function">=></span><span class="Normal"> AcceptableRequestResult;
</span>
<span class="Special">export</span><span class="Normal"> <span class="Statement">type</span><span class="Operator"> <span class="Normal">Headers </span><span class="Operator">=<span class="Normal"> Record</span><span class="typescriptTypeBrackets"><<span class="Type">string</span><span class="typescriptTypeArguments">, </span><span class="Type">string</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Type">string</span><span class="typescriptTypeBracket">[]</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Type">undefined</span><span class="typescriptTypeBrackets">><span class="Normal">;
</span>
<span class="Statement">type</span><span class="Operator"> <span class="Normal">CacheableRequestFn </span><span class="Operator">=<span class="Normal"> (</span>
<span class="typescriptParenthesizedType">	<span class="Normal">opts</span><span class="typescriptParenthesizedType">: </span><span class="Type">string</span><span class="typescriptParenthesizedType"> <span class="Operator">|<span class="typescriptParenthesizedType"> <span class="Normal">URL</span><span class="typescriptParenthesizedType"> <span class="Operator">|<span class="typescriptParenthesizedType"> <span class="Normal">RequestOptions</span><span class="typescriptParenthesizedType">,
	</span><span class="Normal">cb</span><span class="typescriptParenthesizedType">?: </span><span class="Normal">(<span class="Special">response</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">ServerResponse</span><span class="Special"> <span class="Operator">|<span class="Special"> <span class="Normal">ResponseLike) </span><span class="Function">=></span><span class="typescriptParenthesizedType"> <span class="Type">void</span>
<span class="Normal">) </span><span class="Type">=></span><span class="Normal"> CacheableRequest</span><span class="typescriptDotNotation">.<span class="Normal">Emitter;
</span>
<span class="Special">export</span><span class="Normal"> <span class="Statement">interface</span><span class="Normal"> <span class="Function">Options</span><span class="Normal"> <span class="Statement">extends</span><span class="Normal"> <span class="typescriptInterfaceHeritage">URLOptions</span><span class="typescriptInterfaceComma">,<span class="Normal"> <span class="typescriptInterfaceHeritage">SecureContextOptions</span><span class="Normal"> <span class="Function">{
<span class="typescriptObjectType">	<span class="Function">request</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">RequestFunction</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">agent</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Agents</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">false</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">decompress</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">timeout</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Delays</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Type">number</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">prefixUrl</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">URL</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">body</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">Buffer</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">Readable</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">form</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Function">{<span class="typescriptProperty">[<span class="Function">key</span><span class="typescriptTypeAnnotation">:<span class="typescriptComputedMember"> <span class="Type">string</span><span class="typescriptProperty">]<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">any</span><span class="Function">}<span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">json</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Function">{<span class="typescriptProperty">[<span class="Function">key</span><span class="typescriptTypeAnnotation">:<span class="typescriptComputedMember"> <span class="Type">string</span><span class="typescriptProperty">]<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">any</span><span class="Function">}<span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">url</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">URL</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">cookieJar</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">PromiseCookieJar</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">ToughCookieJar</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">ignoreInvalidCookies</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">searchParams</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Function">{<span class="typescriptProperty">[<span class="Function">key</span><span class="typescriptTypeAnnotation">:<span class="typescriptComputedMember"> <span class="Type">string</span><span class="typescriptProperty">]<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Type">number</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Type">null</span><span class="Function">}<span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">URLSearchParams</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">dnsCache</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">CacheableLookup</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">context</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">object</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">hooks</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Hooks</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">followRedirect</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">maxRedirects</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">number</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">cache</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">CacheableRequest.StorageAdapter</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">false</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">throwHttpErrors</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">username</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">password</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">http2</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">allowGetBody</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">lookup</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">CacheableLookup</span><span class="typescriptTypeBracket">[<span class="Constant">'lookup'</span><span class="typescriptTypeBracket">]<span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">rejectUnauthorized</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">headers</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Headers</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">methodRewriting</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="Normal">
<span class="typescriptObjectType">	<span class="Comment">// From http.RequestOptions</span>
<span class="typescriptObjectType">	<span class="Function">localAddress</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">socketPath</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">method</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Method</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">createConnection</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">(<span class="Special">options</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">http.RequestOptions</span><span class="Operator">,<span class="Special"> oncreate</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">(<span class="Special">error</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">Error</span><span class="Operator">,<span class="Special"> socket</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">Socket) </span><span class="Function">=></span><span class="Special"> <span class="Type">void</span><span class="Normal">) </span><span class="Function">=></span><span class="typescriptObjectType"> <span class="Normal">Socket</span><span class="Statement">;
<span class="Function">}
<span class="Normal">
<span class="Special">export</span><span class="Normal"> <span class="Statement">interface</span><span class="Normal"> <span class="Function">NormalizedOptions</span><span class="Normal"> <span class="Statement">extends</span><span class="Normal"> <span class="typescriptInterfaceHeritage">Options</span><span class="Normal"> <span class="Function">{
<span class="typescriptObjectType">	<span class="Function">method</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Method</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">url</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">URL</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">timeout</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Delays</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">prefixUrl</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">ignoreInvalidCookies</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">decompress</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">searchParams</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">URLSearchParams</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">cookieJar</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">PromiseCookieJar</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">headers</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Headers</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">context</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">object</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">hooks</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Required</span><span class="typescriptTypeBrackets"><<span class="Normal">Hooks</span><span class="typescriptTypeBrackets">><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">followRedirect</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">maxRedirects</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">number</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">cache</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">CacheableRequest.StorageAdapter</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">throwHttpErrors</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">dnsCache</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">CacheableLookup</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">http2</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">allowGetBody</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">rejectUnauthorized</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">lookup</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">CacheableLookup</span><span class="typescriptTypeBracket">[<span class="Constant">'lookup'</span><span class="typescriptTypeBracket">]<span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">methodRewriting</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">username</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">password</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="typescriptProperty">[<span class="Function">kRequest</span><span class="typescriptProperty">]<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">HttpRequestFunction</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="typescriptProperty">[<span class="Function">kIsNormalizedAlready</span><span class="typescriptProperty">]<span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="Function">}
<span class="Normal">
<span class="Special">export</span><span class="Normal"> <span class="Statement">interface</span><span class="Normal"> <span class="Function">Defaults</span><span class="Normal"> <span class="Function">{
<span class="typescriptObjectType">	<span class="Function">timeout</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Delays</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">prefixUrl</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">method</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Method</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">ignoreInvalidCookies</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">decompress</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">context</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">object</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">cookieJar</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">PromiseCookieJar</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">ToughCookieJar</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">dnsCache</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">CacheableLookup</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">headers</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Headers</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">hooks</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Required</span><span class="typescriptTypeBrackets"><<span class="Normal">Hooks</span><span class="typescriptTypeBrackets">><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">followRedirect</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">maxRedirects</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">number</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">cache</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">CacheableRequest.StorageAdapter</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">throwHttpErrors</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">http2</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">allowGetBody</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">rejectUnauthorized</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">methodRewriting</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="Normal">
<span class="typescriptObjectType">	<span class="Comment">// Optional</span>
<span class="typescriptObjectType">	<span class="Function">agent</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Agents</span><span class="typescriptObjectType"> <span class="Operator">|<span class="typescriptObjectType"> <span class="Normal">false</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">request</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">RequestFunction</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">searchParams</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">URLSearchParams</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">lookup</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">CacheableLookup</span><span class="typescriptTypeBracket">[<span class="Constant">'lookup'</span><span class="typescriptTypeBracket">]<span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">localAddress</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">createConnection</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Options</span><span class="typescriptTypeBracket">[<span class="Constant">'createConnection'</span><span class="typescriptTypeBracket">]<span class="Statement">;
<span class="Function">}
<span class="Normal">
<span class="Special">export</span><span class="Normal"> <span class="Statement">interface</span><span class="Normal"> <span class="Function">Progress</span><span class="Normal"> <span class="Function">{
<span class="typescriptObjectType">	<span class="Function">percent</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">number</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">transferred</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">number</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">total</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">number</span><span class="Statement">;
<span class="Function">}
<span class="Normal">
<span class="Special">export</span><span class="Normal"> <span class="Statement">interface</span><span class="Normal"> <span class="Function">PlainResponse</span><span class="Normal"> <span class="Statement">extends</span><span class="Normal"> <span class="typescriptInterfaceHeritage">IncomingMessageWithTimings</span><span class="Normal"> <span class="Function">{
<span class="typescriptObjectType">	<span class="Function">requestUrl</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">redirectUrls</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="typescriptTypeBracket">[]</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">request</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Request</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">ip</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">isFromCache</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">boolean</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">statusCode</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">number</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">url</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">timings</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Timings</span><span class="Statement">;
<span class="Function">}
<span class="Normal">
<span class="Comment">// For Promise support</span>
<span class="Special">export</span><span class="Normal"> <span class="Statement">interface</span><span class="Normal"> <span class="Function">Response</span><span class="typescriptInterfaceTypeParameter"><<span class="Normal">T<span class="typescriptInterfaceTypeParameter"> <span class="typescriptGenericDefault">=<span class="typescriptInterfaceTypeParameter"> <span class="Type">unknown</span><span class="typescriptInterfaceTypeParameter">><span class="Normal"> <span class="Statement">extends</span><span class="Normal"> <span class="typescriptInterfaceHeritage">PlainResponse</span><span class="Normal"> <span class="Function">{
<span class="typescriptObjectType">	<span class="Function">body</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">T<span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">rawBody</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">Buffer</span><span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">retryCount</span><span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">number</span><span class="Statement">;
<span class="Function">}
<span class="Normal">
<span class="Special">export</span><span class="Normal"> <span class="Statement">interface</span><span class="Normal"> <span class="Function">RequestEvents</span><span class="typescriptInterfaceTypeParameter"><<span class="Normal">T<span class="typescriptInterfaceTypeParameter">><span class="Normal"> <span class="Function">{
<span class="typescriptObjectType">	<span class="Function">on</span><span class="Normal">(<span class="PreProc">name</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Constant">'request'</span><span class="Operator">,<span class="PreProc"> listener</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">(<span class="Special">request</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">http.ClientRequest) </span><span class="Function">=></span><span class="PreProc"> <span class="Type">void</span><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">T<span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">on</span><span class="typescriptTypeBrackets"><<span class="Normal">R<span class="typescriptGenericCall"> <span class="Statement">extends</span><span class="typescriptGenericCall"> <span class="Normal">Response</span><span class="typescriptTypeBrackets">><span class="Normal">(<span class="PreProc">name</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Constant">'response'</span><span class="Operator">,<span class="PreProc"> listener</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">(<span class="Special">response</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">R) </span><span class="Function">=></span><span class="PreProc"> <span class="Type">void</span><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">T<span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">on</span><span class="typescriptTypeBrackets"><<span class="Normal">R<span class="typescriptGenericCall"> <span class="Statement">extends</span><span class="typescriptGenericCall"> <span class="Normal">Response</span><span class="typescriptGenericCall">, </span><span class="Normal">N<span class="typescriptGenericCall"> <span class="Statement">extends</span><span class="typescriptGenericCall"> <span class="Normal">NormalizedOptions</span><span class="typescriptTypeBrackets">><span class="Normal">(<span class="PreProc">name</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Constant">'redirect'</span><span class="Operator">,<span class="PreProc"> listener</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">(<span class="Special">response</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">R<span class="Operator">,<span class="Special"> nextOptions</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">N) </span><span class="Function">=></span><span class="PreProc"> <span class="Type">void</span><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">T<span class="Statement">;
<span class="typescriptObjectType">	<span class="Function">on</span><span class="Normal">(<span class="PreProc">name</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Constant">'uploadProgress'</span><span class="PreProc"> <span class="Operator">|<span class="PreProc"> <span class="Constant">'downloadProgress'</span><span class="Operator">,<span class="PreProc"> listener</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">(<span class="Special">progress</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">Progress) </span><span class="Function">=></span><span class="PreProc"> <span class="Type">void</span><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Normal">T<span class="Statement">;
<span class="Function">}
<span class="Normal">
<span class="Statement">function</span><span class="Normal"> <span class="Function">validateSearchParameters</span><span class="Normal">(<span class="PreProc">searchParameters</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Record</span><span class="typescriptTypeBrackets"><<span class="Type">string</span><span class="typescriptTypeArguments">, </span><span class="Type">unknown</span><span class="typescriptTypeBrackets">><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="Normal"> asserts searchParameters is Record</span><span class="typescriptTypeBrackets"><<span class="Type">string</span><span class="typescriptTypeArguments">, </span><span class="Type">string</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Type">number</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Type">boolean</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Type">null</span><span class="typescriptTypeBrackets">><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">	<span class="Comment">// eslint-disable-next-line guard-for-in</span>
<span class="typescriptBlock">	<span class="Statement">for</span><span class="typescriptBlock"> <span class="Normal">(const</span><span class="typescriptLoopParen"> <span class="typescriptVariableDeclaration">key</span><span class="typescriptLoopParen"> <span class="Statement">in</span><span class="typescriptLoopParen"> searchParameters</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">value</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> searchParameters</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">key</span><span class="typescriptBlock">];</span>
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">string</span><span class="Normal">(<span class="typescriptFuncCallArg">value</span><span class="Normal">)<span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> <span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">number</span><span class="Normal">(<span class="typescriptFuncCallArg">value</span><span class="Normal">)<span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> <span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">boolean</span><span class="Normal">(<span class="typescriptFuncCallArg">value</span><span class="Normal">)<span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> <span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">null_</span><span class="Normal">(<span class="typescriptFuncCallArg">value</span><span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Special">throw</span><span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> <span class="Type">TypeError</span><span class="Normal">(<span class="Constant">`The \`searchParams\` value '</span><span class="Statement">${</span><span class="Type">String</span><span class="Normal">(<span class="typescriptFuncCallArg">value</span><span class="Normal">)<span class="Statement">}<span class="Constant">' must be a string, number, boolean or null`</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="typescriptBlock">	<span class="Function">}
}</span>
<span class="Normal">
<span class="Statement">function</span><span class="Normal"> <span class="Function">isClientRequest</span><span class="Normal">(<span class="PreProc">clientRequest</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">unknown</span><span class="Normal">)<span class="typescriptTypeAnnotation">:<span class="Normal"> clientRequest </span><span class="Statement">is</span><span class="Normal"> ClientRequest </span><span class="Function">{
<span class="typescriptBlock">	<span class="Statement">return</span><span class="typescriptBlock"> is</span><span class="typescriptDotNotation">.<span class="typescriptBlock">object</span><span class="Normal">(<span class="typescriptFuncCallArg">clientRequest</span><span class="Normal">)<span class="typescriptBlock"> <span class="typescriptBinaryOp">&&</span><span class="typescriptBlock"> <span class="typescriptUnaryOp">!<span class="Normal">(<span class="Constant">'statusCode'</span><span class="typescriptParenExp"> in clientRequest</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Function">}
<span class="Normal">
const </span><span class="typescriptVariableDeclaration">cacheableStore</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> new WeakableMap</span><span class="typescriptTypeBrackets"><<span class="Type">string</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Normal">CacheableRequest.StorageAdapter</span><span class="typescriptTypeArguments">, </span><span class="Normal">CacheableRequestFn</span><span class="typescriptTypeBrackets">><span class="Normal">();

const </span><span class="typescriptVariableDeclaration">waitForOpenFile</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Statement">async</span><span class="Normal"> (</span><span class="PreProc">file</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">ReadStream)</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Promise</span><span class="typescriptTypeBrackets"><<span class="Type">void</span><span class="typescriptTypeBrackets">><span class="PreProc"> <span class="Type">=></span><span class="Normal"> new </span><span class="Type">Promise</span><span class="Normal">((</span><span class="PreProc">resolve</span><span class="Operator">,<span class="PreProc"> reject</span><span class="Normal">)<span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">	<span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">onError</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">(<span class="PreProc">error</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Error)</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">void</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">		reject</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="Normal">)<span class="typescriptBlock">;
	</span><span class="Function">}<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">	file</span><span class="typescriptDotNotation">.<span class="typescriptBlock">once</span><span class="Normal">(<span class="Constant">'error'</span><span class="typescriptFuncCallArg">, onError</span><span class="Normal">)<span class="typescriptBlock">;
	file</span><span class="typescriptDotNotation">.<span class="typescriptBlock">once</span><span class="Normal">(<span class="Constant">'open'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">		file</span><span class="typescriptDotNotation">.<span class="typescriptBlock">off</span><span class="Normal">(<span class="Constant">'error'</span><span class="typescriptFuncCallArg">, onError</span><span class="Normal">)<span class="typescriptBlock">;
		resolve</span><span class="Normal">()</span><span class="typescriptBlock">;
	</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Function">}<span class="Normal">);

const </span><span class="typescriptVariableDeclaration">redirectCodes</span><span class="typescriptTypeAnnotation">:<span class="Normal"> ReadonlySet</span><span class="typescriptTypeBrackets"><<span class="Type">number</span><span class="typescriptTypeBrackets">><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> new </span><span class="Type">Set</span><span class="Normal">(<span class="Function">[<span class="Constant">300</span><span class="typescriptArray">, </span><span class="Constant">301</span><span class="typescriptArray">, </span><span class="Constant">302</span><span class="typescriptArray">, </span><span class="Constant">303</span><span class="typescriptArray">, </span><span class="Constant">304</span><span class="typescriptArray">, </span><span class="Constant">307</span><span class="typescriptArray">, </span><span class="Constant">308</span><span class="Function">]<span class="Normal">);
</span>
<span class="Statement">type</span><span class="Operator"> <span class="Normal">NonEnumerableProperty </span><span class="Operator">=<span class="Normal"> <span class="Constant">'context'</span><span class="Normal"> <span class="Operator">|<span class="Normal"> <span class="Constant">'body'</span><span class="Normal"> <span class="Operator">|<span class="Normal"> <span class="Constant">'json'</span><span class="Normal"> <span class="Operator">|<span class="Normal"> <span class="Constant">'form'</span><span class="Normal">;
const </span><span class="typescriptVariableDeclaration">nonEnumerableProperties</span><span class="typescriptTypeAnnotation">:<span class="Normal"> NonEnumerableProperty</span><span class="typescriptTypeBracket">[]</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Function">[
<span class="typescriptArray">	<span class="Constant">'context'</span><span class="typescriptArray">,
	</span><span class="Constant">'body'</span><span class="typescriptArray">,
	</span><span class="Constant">'json'</span><span class="typescriptArray">,
	</span><span class="Constant">'form'</span>
<span class="Function">]<span class="Normal">;

const </span><span class="typescriptVariableDeclaration">setNonEnumerableProperties</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> (</span><span class="PreProc">sources</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Array</span><span class="typescriptTypeBrackets"><<span class="Normal">Options</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Normal">Defaults</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Type">undefined</span><span class="typescriptTypeBrackets">><span class="Operator">,<span class="PreProc"> to</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Options)</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">void</span><span class="PreProc"> <span class="Type">=></span><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">	<span class="Comment">// Non enumerable properties shall not be merged</span>
<span class="typescriptBlock">	<span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">properties</span><span class="typescriptTypeAnnotation">:<span class="typescriptBlock"> <span class="Normal">Partial</span><span class="typescriptTypeBrackets"><<span class="Function">{<span class="typescriptProperty">[<span class="Function">Key</span><span class="typescriptComputedMember"> <span class="Special">in</span><span class="typescriptComputedMember"> <span class="Normal">NonEnumerableProperty</span><span class="typescriptProperty">]<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">any</span><span class="Function">}<span class="typescriptTypeBrackets">><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Function">{}</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">	<span class="Statement">for</span><span class="typescriptBlock"> <span class="Normal">(const</span><span class="typescriptLoopParen"> <span class="typescriptVariableDeclaration">source</span><span class="typescriptLoopParen"> <span class="Statement">of</span><span class="typescriptLoopParen"> sources</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">source</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Statement">continue</span><span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">for</span><span class="typescriptBlock"> <span class="Normal">(const</span><span class="typescriptLoopParen"> <span class="typescriptVariableDeclaration">name</span><span class="typescriptLoopParen"> <span class="Statement">of</span><span class="typescriptLoopParen"> nonEnumerableProperties</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptUnaryOp">!<span class="Normal">(<span class="Type">name</span><span class="typescriptParenExp"> <span class="Normal">in</span><span class="typescriptParenExp"> source</span><span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Statement">continue</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			properties</span><span class="typescriptProperty">[<span class="Type">name</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Statement">writable</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Constant">true</span><span class="typescriptObjectLiteral">,
				</span><span class="Statement">configurable</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Constant">true</span><span class="typescriptObjectLiteral">,
				</span><span class="Statement">enumerable</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Constant">false</span><span class="typescriptObjectLiteral">,
				</span><span class="Comment">// @ts-ignore TS doesn't see the check above</span>
<span class="typescriptObjectLiteral">				</span><span class="Statement">value</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> source</span><span class="typescriptProperty">[<span class="Type">name</span><span class="typescriptObjectLiteral">]
			</span><span class="Function">}<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="typescriptBlock">	<span class="Function">}
<span class="Normal">
<span class="typescriptBlock">	<span class="Type">Object</span><span class="typescriptGlobalObjectDot">.<span class="Statement">defineProperties</span><span class="Normal">(<span class="typescriptFuncCallArg">to, properties</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Function">}<span class="Normal">;
</span>
<span class="Special">export</span><span class="Normal"> <span class="Statement">class</span><span class="Normal"> <span class="typescriptClassName">RequestError</span><span class="Normal"> <span class="Statement">extends</span><span class="Normal"> <span class="Type">Error</span><span class="Normal"> <span class="Function">{
<span class="typescriptClassBlock">	<span class="Function">code</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptClassBlock"> <span class="Type">string</span><span class="typescriptClassBlock">;
	</span><span class="Function">stack</span><span class="typescriptMemberOptionality">!<span class="typescriptTypeAnnotation">:<span class="typescriptClassBlock"> <span class="Type">string</span><span class="typescriptClassBlock">;
	</span><span class="Function">declare</span><span class="typescriptClassBlock"> <span class="Statement">readonly</span><span class="typescriptClassBlock"> <span class="Function">options</span><span class="typescriptTypeAnnotation">:<span class="typescriptClassBlock"> <span class="Normal">NormalizedOptions</span><span class="typescriptClassBlock">;
	</span><span class="Statement">readonly</span><span class="typescriptClassBlock"> <span class="Function">response</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptClassBlock"> <span class="Normal">Response</span><span class="typescriptClassBlock">;
	</span><span class="Statement">readonly</span><span class="typescriptClassBlock"> <span class="Function">request</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptClassBlock"> <span class="Normal">Request</span><span class="typescriptClassBlock">;
	</span><span class="Statement">readonly</span><span class="typescriptClassBlock"> <span class="Function">timings</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptClassBlock"> <span class="Normal">Timings</span><span class="typescriptClassBlock">;
<span class="Normal">
<span class="typescriptClassBlock">	<span class="Function">constructor</span><span class="Normal">(<span class="PreProc">message</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">string</span><span class="Operator">,<span class="PreProc"> error</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Partial</span><span class="typescriptTypeBrackets"><<span class="Normal">Error</span><span class="typescriptTypeArguments"> <span class="Operator">&<span class="typescriptTypeArguments"> <span class="Function">{code</span><span class="typescriptMemberOptionality">?<span class="typescriptTypeAnnotation">:<span class="typescriptObjectType"> <span class="Type">string</span><span class="Function">}<span class="typescriptTypeBrackets">><span class="Operator">,<span class="PreProc"> self</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Request</span><span class="PreProc"> <span class="Operator">|<span class="PreProc"> <span class="Normal">NormalizedOptions)</span><span class="typescriptClassBlock"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Type">super</span><span class="Normal">(<span class="typescriptFuncCallArg">message</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Type">Error</span><span class="typescriptBlock">.captureStackTrace</span><span class="Normal">(<span class="Type">this</span><span class="typescriptFuncCallArg">, </span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">constructor</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="Statement">name</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">'RequestError'</span><span class="typescriptBlock">;
		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">code </span><span class="typescriptAssign">=<span class="typescriptBlock"> error</span><span class="typescriptDotNotation">.<span class="typescriptBlock">code;</span>
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">self</span><span class="typescriptConditionalParen"> instanceof </span><span class="Type">Request</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">Object</span><span class="typescriptGlobalObjectDot">.<span class="Statement">defineProperty</span><span class="Normal">(<span class="Type">this</span><span class="typescriptFuncCallArg">, </span><span class="Constant">'request'</span><span class="typescriptFuncCallArg">, </span><span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Statement">enumerable</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Constant">false</span><span class="typescriptObjectLiteral">,
				</span><span class="Statement">value</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Type">self</span>
<span class="typescriptObjectLiteral">			</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Type">Object</span><span class="typescriptGlobalObjectDot">.<span class="Statement">defineProperty</span><span class="Normal">(<span class="Type">this</span><span class="typescriptFuncCallArg">, </span><span class="Constant">'response'</span><span class="typescriptFuncCallArg">, </span><span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Statement">enumerable</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Constant">false</span><span class="typescriptObjectLiteral">,
				</span><span class="Statement">value</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Type">self</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kResponse</span><span class="typescriptObjectLiteral">]
			</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Type">Object</span><span class="typescriptGlobalObjectDot">.<span class="Statement">defineProperty</span><span class="Normal">(<span class="Type">this</span><span class="typescriptFuncCallArg">, </span><span class="Constant">'options'</span><span class="typescriptFuncCallArg">, </span><span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Comment">// This fails because of TS 3.7.2 useDefineForClassFields</span>
<span class="typescriptObjectLiteral">				</span><span class="Comment">// Ref: https://github.com/microsoft/TypeScript/issues/34972</span>
<span class="typescriptObjectLiteral">				</span><span class="Statement">enumerable</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Constant">false</span><span class="typescriptObjectLiteral">,
				</span><span class="Statement">value</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Type">self</span><span class="typescriptDotNotation">.<span class="typescriptObjectLiteral">options
			</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">Object</span><span class="typescriptGlobalObjectDot">.<span class="Statement">defineProperty</span><span class="Normal">(<span class="Type">this</span><span class="typescriptFuncCallArg">, </span><span class="Constant">'options'</span><span class="typescriptFuncCallArg">, </span><span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Comment">// This fails because of TS 3.7.2 useDefineForClassFields</span>
<span class="typescriptObjectLiteral">				</span><span class="Comment">// Ref: https://github.com/microsoft/TypeScript/issues/34972</span>
<span class="typescriptObjectLiteral">				</span><span class="Statement">enumerable</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Constant">false</span><span class="typescriptObjectLiteral">,
				</span><span class="Statement">value</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Type">self</span>
<span class="typescriptObjectLiteral">			</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">timings </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">request</span><span class="typescriptTernaryOp">?<span class="typescriptTernary">.timings;</span>
<span class="Normal">
<span class="typescriptTernary">		</span><span class="Comment">// Recover the original stacktrace</span>
<span class="typescriptTernary">		if </span><span class="Normal">(<span class="typescriptUnaryOp">!<span class="typescriptFuncCallArg">is</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">stack</span><span class="Normal">))</span><span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">const indexOfMessage </span><span class="typescriptObjectLiteral">= </span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">stack</span><span class="typescriptObjectLiteral">.<span class="Statement">indexOf</span><span class="Normal">(<span class="PreProc">this.message</span><span class="Normal">)<span class="typescriptObjectLiteral"> + </span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">message</span><span class="typescriptObjectLiteral">.<span class="Statement">length</span><span class="typescriptObjectLiteral">;
			</span><span class="Statement">const thisStackTrace </span><span class="typescriptObjectLiteral">= </span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">stack</span><span class="typescriptObjectLiteral">.<span class="Statement">slice</span><span class="Normal">(<span class="PreProc">indexOfMessage</span><span class="Normal">)<span class="typescriptObjectLiteral">.<span class="Statement">split</span><span class="Normal">(<span class="PreProc">'\n'</span><span class="Normal">)<span class="typescriptObjectLiteral">.<span class="Statement">reverse</span><span class="Normal">()</span><span class="typescriptObjectLiteral">;
			</span><span class="Statement">const errorStackTrace </span><span class="typescriptObjectLiteral">= </span><span class="Statement">error</span><span class="typescriptObjectLiteral">.<span class="Statement">stack</span><span class="typescriptObjectLiteral">.<span class="Statement">slice</span><span class="Normal">(<span class="PreProc">error.stack.indexOf(error.message!</span><span class="Normal">)<span class="typescriptObjectLiteral"> + </span><span class="Statement">error</span><span class="typescriptObjectLiteral">.<span class="Statement">message</span><span class="typescriptObjectLiteral">!.</span><span class="Statement">length</span><span class="typescriptObjectLiteral">).</span><span class="Statement">split</span><span class="Normal">(<span class="PreProc">'\n'</span><span class="Normal">)<span class="typescriptObjectLiteral">.<span class="Statement">reverse</span><span class="Normal">()</span><span class="typescriptObjectLiteral">;
<span class="Normal">
<span class="typescriptObjectLiteral">			</span><span class="Comment">// Remove duplicated traces</span>
<span class="typescriptObjectLiteral">			</span><span class="Statement">while </span><span class="Normal">(<span class="PreProc">errorStackTrace.length !</span><span class="typescriptDefaultParam">==</span><span class="PreProc"> <span class="Constant">0<span class="PreProc"> <span class="typescriptBinaryOp">&&</span><span class="PreProc"> errorStackTrace</span><span class="typescriptProperty">[<span class="Constant">0<span class="PreProc">] </span><span class="typescriptDefaultParam">===</span><span class="PreProc"> thisStackTrace</span><span class="typescriptProperty">[<span class="Constant">0<span class="PreProc">]<span class="Normal">)<span class="typescriptObjectLiteral"> <span class="Function">{
<span class="typescriptBlock">				thisStackTrace</span><span class="typescriptDotNotation">.<span class="Statement">shift</span><span class="Normal">()</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptObjectLiteral">			</span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">stack </span><span class="typescriptObjectLiteral">= `</span><span class="Statement">$<span class="typescriptObjectLiteral">{<span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">stack</span><span class="typescriptObjectLiteral">.<span class="Statement">slice</span><span class="Normal">(<span class="PreProc">0<span class="Operator">,<span class="PreProc"> indexOfMessage</span><span class="Normal">)<span class="Function">}<span class="typescriptTernary">$<span class="Function">{<span class="Statement">thisStackTrace</span><span class="typescriptObjectLiteral">.<span class="Statement">reverse</span><span class="Normal">()</span><span class="typescriptObjectLiteral">.<span class="Statement">join</span><span class="Normal">(<span class="PreProc">'\n'</span><span class="Normal">)<span class="Function">}<span class="typescriptTernary">$<span class="Function">{<span class="Statement">errorStackTrace</span><span class="typescriptObjectLiteral">.<span class="Statement">reverse</span><span class="Normal">()</span><span class="typescriptObjectLiteral">.<span class="Statement">join</span><span class="Normal">(<span class="PreProc">'\n'</span><span class="Normal">)<span class="Function">}<span class="Constant">`;
		}
	}
}</span>
<span class="Normal">
<span class="Constant">export class MaxRedirectsError extends RequestError {
	declare readonly response: Response;
	declare readonly request: Request;
	declare readonly timings: Timings;</span>
<span class="Normal">
<span class="Constant">	constructor(request: Request) {
		super(`</span><span class="typescriptTernary">Redirected $</span><span class="Function">{<span class="Statement">request</span><span class="typescriptObjectLiteral">.<span class="Statement">options</span><span class="typescriptObjectLiteral">.<span class="Statement">maxRedirects</span><span class="Function">}<span class="typescriptTernary"> times</span><span class="typescriptDotNotation">.<span class="typescriptTernary"> Aborting</span><span class="typescriptDotNotation">.<span class="Constant">`, {}, request);
		this.name = 'MaxRedirectsError';
	}
}</span>
<span class="Normal">
<span class="Constant">export class HTTPError extends RequestError {
	declare readonly response: Response;
	declare readonly request: Request;
	declare readonly timings: Timings;</span>
<span class="Normal">
<span class="Constant">	constructor(response: Response) {
		super(`</span><span class="Type">Response</span><span class="typescriptTernary"> code $</span><span class="Function">{<span class="Statement">response</span><span class="typescriptObjectLiteral">.<span class="Statement">statusCode</span><span class="Function">}<span class="typescriptTernary"> <span class="Normal">(<span class="typescriptParenExp">$<span class="Function">{<span class="Statement">response</span><span class="typescriptObjectLiteral">.<span class="Statement">statusMessage</span><span class="typescriptObjectLiteral">!<span class="Function">}<span class="Normal">)<span class="Constant">`, {}, response.request);
		this.name = 'HTTPError';
	}
}</span>
<span class="Normal">
<span class="Constant">export class CacheError extends RequestError {
	declare readonly request: Request;</span>
<span class="Normal">
<span class="Constant">	constructor(error: Error, request: Request) {
		super(error.message, error, request);
		this.name = 'CacheError';
	}
}</span>
<span class="Normal">
<span class="Constant">export class UploadError extends RequestError {
	declare readonly request: Request;</span>
<span class="Normal">
<span class="Constant">	constructor(error: Error, request: Request) {
		super(error.message, error, request);
		this.name = 'UploadError';
	}
}</span>
<span class="Normal">
<span class="Constant">export class TimeoutError extends RequestError {
	declare readonly request: Request;
	readonly timings: Timings;
	readonly event: string;</span>
<span class="Normal">
<span class="Constant">	constructor(error: TimedOutTimeoutError, timings: Timings, request: Request) {
		super(error.message, error, request);
		this.name = 'TimeoutError';
		this.event = error.event;
		this.timings = timings;
	}
}</span>
<span class="Normal">
<span class="Constant">export class ReadError extends RequestError {
	declare readonly request: Request;
	declare readonly response: Response;
	declare readonly timings: Timings;</span>
<span class="Normal">
<span class="Constant">	constructor(error: Error, request: Request) {
		super(error.message, error, request);
		this.name = 'ReadError';
	}
}</span>
<span class="Normal">
<span class="Constant">export class UnsupportedProtocolError extends RequestError {
	constructor(options: NormalizedOptions) {
		super(`</span><span class="typescriptTernary">Unsupported protocol </span><span class="Constant">"${options.url.protocol}"`, {}, options);
		this.name = 'UnsupportedProtocolError';
	}
}</span>
<span class="Normal">
<span class="Constant">const proxiedRequestEvents = [
	'socket',
	'abort',
	'connect',
	'continue',
	'information',
	'upgrade',
	'timeout'
];</span>
<span class="Normal">
<span class="Constant">export default class Request extends Duplex implements RequestEvents<Request> {
	['constructor']: typeof Request;</span>
<span class="Normal">
<span class="Constant">	declare [kUnproxyEvents]: () => void;
	declare _cannotHaveBody: boolean;
	[kDownloadedSize]: number;
	[kUploadedSize]: number;
	[kStopReading]: boolean;
	[kTriggerRead]: boolean;
	[kBody]: Options['body'];
	[kBodySize]?: number;
	[kServerResponsesPiped]: Set<ServerResponse>;
	[kIsFromCache]?: boolean;
	[kStartedReading]?: boolean;
	[kCancelTimeouts]?: () => void;
	[kResponseSize]?: number;
	[kResponse]?: IncomingMessage;
	[kRequest]?: ClientRequest;
	_noPipe?: boolean;
	_progressCallbacks: Array<() => void>;</span>
<span class="Normal">
<span class="Constant">	declare options: NormalizedOptions;
	declare requestUrl: string;
	finalized: boolean;
	redirects: string[];</span>
<span class="Normal">
<span class="Constant">	constructor(url: string | URL, options: Options = {}, defaults?: Defaults) {
		super({
			// It needs to be zero because we're just proxying the data to another stream
			highWaterMark: 0
		});</span>
<span class="Normal">
<span class="Constant">		this[kDownloadedSize] = 0;
		this[kUploadedSize] = 0;
		this.finalized = false;
		this[kServerResponsesPiped] = new Set<ServerResponse>();
		this.redirects = [];
		this[kStopReading] = false;
		this[kTriggerRead] = false;</span>
<span class="Normal">
<span class="Constant">		// TODO: Remove this when targeting Node.js >= 12
		this._progressCallbacks = [];</span>
<span class="Normal">
<span class="Constant">		const unlockWrite = (): void => this._unlockWrite();
		const lockWrite = (): void => this._lockWrite();</span>
<span class="Normal">
<span class="Constant">		this.on('pipe', (source: Writable) => {
			source.prependListener('data', unlockWrite);
			source.on('data', lockWrite);</span>
<span class="Normal">
<span class="Constant">			source.prependListener('end', unlockWrite);
			source.on('end', lockWrite);
		});</span>
<span class="Normal">
<span class="Constant">		this.on('unpipe', (source: Writable) => {
			source.off('data', unlockWrite);
			source.off('data', lockWrite);</span>
<span class="Normal">
<span class="Constant">			source.off('end', unlockWrite);
			source.off('end', lockWrite);
		});</span>
<span class="Normal">
<span class="Constant">		this.on('pipe', source => {
			if (source instanceof IncomingMessage) {
				this.options.headers = {
					...source.headers,
					...this.options.headers
				};
			}
		});</span>
<span class="Normal">
<span class="Constant">		const {json, body, form} = options;
		if (json || body || form) {
			this._lockWrite();
		}</span>
<span class="Normal">
<span class="Constant">		(async (nonNormalizedOptions: Options) => {
			try {
				if (nonNormalizedOptions.body instanceof ReadStream) {
					await waitForOpenFile(nonNormalizedOptions.body);
				}</span>
<span class="Normal">
<span class="Constant">				if (kIsNormalizedAlready in nonNormalizedOptions) {
					this.options = nonNormalizedOptions as NormalizedOptions;
				} else {
					// @ts-ignore Common TypeScript bug saying that `</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptTernary">constructor</span><span class="Constant">` is not accessible
					this.options = this.constructor.normalizeArguments(url, nonNormalizedOptions, defaults);
				}</span>
<span class="Normal">
<span class="Constant">				const {url: normalizedURL} = this.options;</span>
<span class="Normal">
<span class="Constant">				if (!normalizedURL) {
					throw new TypeError('Missing `</span><span class="typescriptTernary">url</span><span class="Constant">` property');
				}</span>
<span class="Normal">
<span class="Constant">				this.requestUrl = normalizedURL.toString();
				decodeURI(this.requestUrl);</span>
<span class="Normal">
<span class="Constant">				await this._finalizeBody();
				await this._makeRequest();</span>
<span class="Normal">
<span class="Constant">				this.finalized = true;
				this.emit('finalized');
			} catch (error) {
				if (error instanceof RequestError) {
					this._beforeError(error);
					return;
				}</span>
<span class="Normal">
<span class="Constant">				this.destroy(error);
			}
		})(options);
	}</span>
<span class="Normal">
<span class="Constant">	static normalizeArguments(url?: string | URL, options?: Options, defaults?: Defaults): NormalizedOptions {
		const rawOptions = options;</span>
<span class="Normal">
<span class="Constant">		if (is.object(url) && !is.urlInstance(url)) {
			options = {...defaults as NormalizedOptions, ...(url as Options), ...options};
		} else {
			if (url && options && options.url) {
				throw new TypeError('The `</span><span class="typescriptTernary">url</span><span class="Constant">` option is mutually exclusive with the `</span><span class="typescriptTernary">input</span><span class="Constant">` argument');
			}</span>
<span class="Normal">
<span class="Constant">			options = {...defaults as NormalizedOptions, ...options};</span>
<span class="Normal">
<span class="Constant">			if (url) {
				options.url = url;
			}
		}</span>
<span class="Normal">
<span class="Constant">		if (rawOptions && defaults) {
			for (const key in rawOptions) {
				// @ts-ignore Dear TypeScript, all object keys are strings (or symbols which are NOT enumerable).
				if (is.undefined(rawOptions[key]) && !is.undefined(defaults[key])) {
					// @ts-ignore See the note above
					options[key] = defaults[key];
				}
			}
		}</span>
<span class="Normal">
<span class="Constant">		// TODO: Deprecate URL options in Got 12.</span>
<span class="Normal">
<span class="Constant">		// Support extend-specific options
		if (options.cache === false) {
			options.cache = undefined;
		}</span>
<span class="Normal">
<span class="Constant">		// Nice type assertions
		assert.any([is.string, is.undefined], options.method);
		assert.any([is.object, is.undefined], options.headers);
		assert.any([is.string, is.urlInstance, is.undefined], options.prefixUrl);
		assert.any([is.object, is.undefined], options.cookieJar);
		assert.any([is.object, is.string, is.undefined], options.searchParams);
		assert.any([is.object, is.string, is.undefined], options.cache);
		assert.any([is.object, is.number, is.undefined], options.timeout);
		assert.any([is.object, is.undefined], options.context);
		assert.any([is.object, is.undefined], options.hooks);
		assert.any([is.boolean, is.undefined], options.decompress);
		assert.any([is.boolean, is.undefined], options.ignoreInvalidCookies);
		assert.any([is.boolean, is.undefined], options.followRedirect);
		assert.any([is.number, is.undefined], options.maxRedirects);
		assert.any([is.boolean, is.undefined], options.throwHttpErrors);
		assert.any([is.boolean, is.undefined], options.http2);
		assert.any([is.boolean, is.undefined], options.allowGetBody);
		assert.any([is.boolean, is.undefined], options.rejectUnauthorized);</span>
<span class="Normal">
<span class="Constant">		// `</span><span class="typescriptTernary">options</span><span class="typescriptDotNotation">.<span class="Statement">method</span><span class="Constant">`
		if (is.string(options.method)) {
			options.method = options.method.toUpperCase() as Method;
		} else {
			options.method = 'GET';
		}</span>
<span class="Normal">
<span class="Constant">		// `</span><span class="typescriptTernary">options</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="Constant">`
		if (is.undefined(options.headers)) {
			options.headers = {};
		} else if (options.headers === defaults?.headers) {
			options.headers = {...options.headers};
		} else {
			options.headers = lowercaseKeys({...(defaults?.headers), ...options.headers});
		}</span>
<span class="Normal">
<span class="Constant">		// Disallow legacy `</span><span class="typescriptTernary">url</span><span class="typescriptDotNotation">.<span class="typescriptTernary">Url</span><span class="Constant">`
		if ('slashes' in options) {
			throw new TypeError('The legacy `</span><span class="typescriptTernary">url</span><span class="typescriptDotNotation">.<span class="typescriptTernary">Url</span><span class="Constant">` has been deprecated. Use `</span><span class="Type">URL</span><span class="Constant">` instead.');
		}</span>
<span class="Normal">
<span class="Constant">		// `</span><span class="typescriptTernary">options</span><span class="typescriptDotNotation">.<span class="typescriptTernary">auth</span><span class="Constant">`
		if ('auth' in options) {
			throw new TypeError('Parameter `</span><span class="typescriptTernary">auth</span><span class="Constant">` is deprecated. Use `</span><span class="typescriptTernary">username</span><span class="Constant">` / `</span><span class="typescriptTernary">password</span><span class="Constant">` instead.');
		}</span>
<span class="Normal">
<span class="Constant">		// `</span><span class="typescriptTernary">options</span><span class="typescriptDotNotation">.<span class="typescriptTernary">prefixUrl</span><span class="Constant">` & `</span><span class="typescriptTernary">options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="Constant">`
		if (options.prefixUrl) {
			options.prefixUrl = options.prefixUrl.toString();</span>
<span class="Normal">
<span class="Constant">			if (options.prefixUrl !== '' && !options.prefixUrl.endsWith('/')) {
				options.prefixUrl += '/';
			}
		} else {
			options.prefixUrl = '';
		}</span>
<span class="Normal">
<span class="Constant">		if (is.string(options.url)) {
			if (options.url.startsWith('/')) {
				throw new Error('`</span><span class="typescriptTernary">input</span><span class="Constant">` must not start with a slash when using `</span><span class="typescriptTernary">prefixUrl</span><span class="Constant">`');
			}</span>
<span class="Normal">
<span class="Constant">			options.url = optionsToUrl(options.prefixUrl + options.url, options as Options & {searchParams?: URLSearchParams});
		} else if ((is.undefined(options.url) && options.prefixUrl !== '') || options.protocol) {
			options.url = optionsToUrl(options.prefixUrl, options as Options & {searchParams?: URLSearchParams});
		}</span>
<span class="Normal">
<span class="Constant">		if (options.url) {
			// Make it possible to change `</span><span class="typescriptTernary">options</span><span class="typescriptDotNotation">.<span class="typescriptTernary">prefixUrl</span><span class="Constant">`
			let {prefixUrl} = options;
			Object.defineProperty(options, 'prefixUrl', {
				set: (value: string) => {
					const url = options!.url as URL;</span>
<span class="Normal">
<span class="Constant">					if (!url.href.startsWith(value)) {
						throw new Error(`</span><span class="typescriptTernary">Cannot change \</span><span class="Constant">`prefixUrl\` from </span><span class="Statement">${</span><span class="typescriptTemplateSubstitution">prefixUrl</span><span class="Statement">}<span class="Constant"> to </span><span class="Statement">${</span><span class="typescriptTemplateSubstitution">value</span><span class="Statement">}<span class="Constant">: </span><span class="Statement">${</span><span class="typescriptTemplateSubstitution">url</span><span class="typescriptDotNotation">.<span class="Statement">href}</span><span class="Constant">`<span class="typescriptTernary">);
					}</span>
<span class="Normal">
<span class="typescriptTernary">					options</span><span class="typescriptUnaryOp">!<span class="typescriptTernary">.url </span><span class="typescriptAssign">=<span class="typescriptTernary"> <span class="Normal">new</span><span class="typescriptTernary"> <span class="Type">URL</span><span class="Normal">(<span class="typescriptFuncCallArg">value </span><span class="typescriptBinaryOp">+<span class="typescriptFuncCallArg"> url</span><span class="typescriptDotNotation">.<span class="Statement">href</span><span class="typescriptDotNotation">.<span class="Statement">slice</span><span class="Normal">(<span class="typescriptFuncCallArg">prefixUrl</span><span class="typescriptDotNotation">.<span class="Statement">length</span><span class="Normal">))</span><span class="typescriptTernary">;
					prefixUrl </span><span class="typescriptAssign">=<span class="typescriptTernary"> value;
				},
				get</span><span class="typescriptTernaryOp">:<span class="typescriptBlock"> <span class="Normal">()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptBlock"> prefixUrl
			</span><span class="Function">}<span class="typescriptClassBlock">);</span>
<span class="Normal">
<span class="typescriptClassBlock">			</span><span class="Comment">// Protocol check</span>
<span class="typescriptClassBlock">			</span><span class="Function">let</span><span class="typescriptClassBlock"> <span class="Function">{<span class="typescriptBlock">protocol</span><span class="Function">}<span class="typescriptClassBlock"> <span class="typescriptAssign">=<span class="typescriptClassBlock"> options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="typescriptClassBlock">;
<span class="Normal">
<span class="typescriptClassBlock">			</span><span class="Function">if</span><span class="typescriptClassBlock"> <span class="Normal">(<span class="PreProc">protocol </span><span class="typescriptDefaultParam">===</span><span class="PreProc"> <span class="Constant">'unix:'</span><span class="Normal">)<span class="typescriptClassBlock"> <span class="Function">{
<span class="typescriptBlock">				protocol </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">'http:'</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> <span class="Type">URL</span><span class="Normal">(<span class="Constant">`http://unix</span><span class="Statement">${</span><span class="typescriptTemplateSubstitution">options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="typescriptDotNotation">.<span class="Statement">pathname}${</span><span class="typescriptTemplateSubstitution">options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="typescriptDotNotation">.<span class="Statement">search}</span><span class="Constant">`<span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptClassBlock">			</span><span class="Function">if</span><span class="typescriptClassBlock"> <span class="Normal">(<span class="PreProc">options.url.search</span><span class="Normal">)<span class="typescriptClassBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">triggerSearchParameters</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">'_GOT_INTERNAL_TRIGGER_NORMALIZATION'</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="typescriptDotNotation">.<span class="Statement">searchParams</span><span class="typescriptDotNotation">.<span class="Statement">append</span><span class="Normal">(<span class="typescriptFuncCallArg">triggerSearchParameters, </span><span class="Constant">''</span><span class="Normal">)<span class="typescriptBlock">;
				options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="typescriptDotNotation">.<span class="Statement">searchParams</span><span class="typescriptDotNotation">.<span class="Statement">delete</span><span class="Normal">(<span class="typescriptFuncCallArg">triggerSearchParameters</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptClassBlock">			</span><span class="Function">if</span><span class="typescriptClassBlock"> <span class="Normal">(<span class="PreProc">protocol !</span><span class="typescriptDefaultParam">==</span><span class="PreProc"> <span class="Constant">'http:'</span><span class="PreProc"> && protocol !</span><span class="typescriptDefaultParam">==</span><span class="PreProc"> <span class="Constant">'https:'</span><span class="Normal">)<span class="typescriptClassBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Special">throw</span><span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> UnsupportedProtocolError</span><span class="Normal">(<span class="typescriptFuncCallArg">options </span><span class="Special">as</span><span class="typescriptFuncCallArg"> <span class="Normal">NormalizedOptions)</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptClassBlock">		</span><span class="Function">}
<span class="Normal">
		</span><span class="Comment">// `options.username` & `options.password`</span>
<span class="Normal">		options</span><span class="typescriptDotNotation">.<span class="Statement">username</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> options</span><span class="typescriptDotNotation">.<span class="Statement">username</span><span class="Normal"> <span class="typescriptTernaryOp">?<span class="typescriptTernary">? </span><span class="Constant">''</span><span class="typescriptTernary">;
		options</span><span class="typescriptDotNotation">.<span class="Statement">password</span><span class="typescriptTernary"> <span class="typescriptAssign">=<span class="typescriptTernary"> options</span><span class="typescriptDotNotation">.<span class="Statement">password</span><span class="typescriptTernary"> <span class="typescriptTernaryOp">?<span class="typescriptTernary">? </span><span class="Constant">''</span><span class="typescriptTernary">;
<span class="Normal">
<span class="typescriptTernary">		if </span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="Normal">)<span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">options</span><span class="typescriptObjectLiteral">.<span class="Statement">url</span><span class="typescriptObjectLiteral">.<span class="Statement">username </span><span class="typescriptObjectLiteral">= </span><span class="Statement">options</span><span class="typescriptObjectLiteral">.<span class="Statement">username</span><span class="typescriptObjectLiteral">;
			</span><span class="Statement">options</span><span class="typescriptObjectLiteral">.<span class="Statement">url</span><span class="typescriptObjectLiteral">.<span class="Statement">password </span><span class="typescriptObjectLiteral">= </span><span class="Statement">options</span><span class="typescriptObjectLiteral">.<span class="Statement">password</span><span class="typescriptObjectLiteral">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptTernary">		</span><span class="Comment">// `options.cookieJar`</span>
<span class="typescriptTernary">		const </span><span class="Function">{<span class="Statement">cookieJar</span><span class="Function">}<span class="typescriptTernary"> = options;
		if </span><span class="Normal">(<span class="typescriptFuncCallArg">cookieJar</span><span class="Normal">)<span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">let </span><span class="typescriptObjectLiteral">{<span class="Statement">setCookie</span><span class="typescriptObjectLiteral">, </span><span class="Statement">getCookieString</span><span class="Function">}<span class="typescriptTernary"> = cookieJar;</span>
<span class="Normal">
<span class="typescriptTernary">			</span><span class="Type">assert</span><span class="typescriptTernary">.<span class="typescriptFuncImpl">function_(setCookie);
			assert.function_(getCookieString);</span>
<span class="Normal">
<span class="typescriptFuncImpl">			/* istanbul ignore next: Horrible `tough-cookie` v3 check */
			if (setCookie.length === 4 && getCookieString.length === 0) </span><span class="Function">{
<span class="typescriptBlock">				setCookie </span><span class="typescriptAssign">=<span class="typescriptBlock"> promisify</span><span class="Normal">(<span class="typescriptFuncCallArg">setCookie</span><span class="typescriptDotNotation">.<span class="Statement">bind</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">cookieJar</span><span class="Normal">))</span><span class="typescriptBlock">;
				getCookieString </span><span class="typescriptAssign">=<span class="typescriptBlock"> promisify</span><span class="Normal">(<span class="typescriptFuncCallArg">getCookieString</span><span class="typescriptDotNotation">.<span class="Statement">bind</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">cookieJar</span><span class="Normal">))</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				options</span><span class="typescriptDotNotation">.<span class="typescriptBlock">cookieJar </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptObjectLiteral">					</span><span class="Statement">setCookie</span><span class="typescriptObjectLiteral">,
					</span><span class="Statement">getCookieString
				</span><span class="Function">}<span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptTernary">		}</span>
<span class="Normal">
<span class="typescriptTernary">		</span><span class="Comment">// `options.searchParams`</span>
<span class="typescriptTernary">		if </span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="Statement">searchParams</span><span class="Normal">)<span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">if </span><span class="Normal">(<span class="PreProc">!is.string(options.searchParams</span><span class="Normal">)<span class="typescriptObjectLiteral"> && !(</span><span class="Statement">options</span><span class="typescriptObjectLiteral">.<span class="Statement">searchParams instanceof URLSearchParams</span><span class="typescriptObjectLiteral">)) {
				</span><span class="Statement">validateSearchParameters</span><span class="Normal">(<span class="PreProc">options.searchParams</span><span class="Normal">)<span class="typescriptObjectLiteral">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptTernary">			options</span><span class="typescriptDotNotation">.<span class="Statement">searchParams</span><span class="typescriptTernary"> <span class="typescriptAssign">=<span class="typescriptTernary"> <span class="Normal">new</span><span class="typescriptTernary"> <span class="Type">URLSearchParams</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="Statement">searchParams</span><span class="typescriptFuncCallArg"> <span class="Special">as</span><span class="typescriptFuncCallArg"> <span class="Normal">Record</span><span class="typescriptTypeBrackets"><<span class="Type">string</span><span class="typescriptTypeArguments">, </span><span class="Type">string</span><span class="typescriptTypeBrackets">><span class="Normal">)<span class="typescriptTernary">;
<span class="Normal">
<span class="typescriptTernary">			</span><span class="Comment">// `normalizeArguments()` is also used to merge options</span>
<span class="typescriptTernary">			const defaultsAsOptions </span><span class="typescriptAssign">=<span class="typescriptTernary"> defaults </span><span class="Special">as</span><span class="typescriptTernary"> <span class="Normal">Options</span><span class="typescriptTernary"> <span class="Operator">|<span class="typescriptTernary"> <span class="Type">undefined</span><span class="typescriptTernary">;
			if </span><span class="Normal">(<span class="typescriptFuncCallArg">defaultsAsOptions </span><span class="typescriptBinaryOp">&&</span><span class="typescriptFuncCallArg"> defaultsAsOptions</span><span class="typescriptDotNotation">.<span class="Statement">searchParams</span><span class="typescriptFuncCallArg"> <span class="Normal">instanceof</span><span class="typescriptFuncCallArg"> <span class="Type">URLSearchParams</span><span class="Normal">)<span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Statement">defaultsAsOptions</span><span class="typescriptObjectLiteral">.<span class="Statement">searchParams</span><span class="typescriptObjectLiteral">.<span class="Statement">forEach</span><span class="Normal">(<span class="PreProc">(value</span><span class="Operator">,<span class="PreProc"> key</span><span class="Normal">)<span class="typescriptObjectLiteral"> => {
					(</span><span class="Statement">options</span><span class="typescriptObjectLiteral">!.</span><span class="Statement">searchParams as URLSearchParams</span><span class="typescriptObjectLiteral">).</span><span class="Statement">append</span><span class="Normal">(<span class="PreProc">key</span><span class="Operator">,<span class="PreProc"> value</span><span class="Normal">)<span class="typescriptObjectLiteral">;
				</span><span class="Function">}<span class="typescriptTernary">);
			}</span>
<span class="Normal">
<span class="typescriptTernary">			if </span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="Normal">)<span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Statement">options</span><span class="typescriptObjectLiteral">.<span class="Statement">url</span><span class="typescriptObjectLiteral">.<span class="Statement">search </span><span class="typescriptObjectLiteral">= </span><span class="Statement">options</span><span class="typescriptObjectLiteral">.<span class="Statement">searchParams</span><span class="typescriptObjectLiteral">.<span class="Statement">toString</span><span class="Normal">()</span><span class="typescriptObjectLiteral">;
			</span><span class="Function">}
<span class="typescriptTernary">		}</span>
<span class="Normal">
<span class="typescriptTernary">		</span><span class="Comment">// `options.cache`</span>
<span class="typescriptTernary">		const </span><span class="Function">{<span class="Statement">cache</span><span class="Function">}<span class="typescriptTernary"> = options;
		if </span><span class="Normal">(<span class="typescriptFuncCallArg">cache</span><span class="Normal">)<span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">if </span><span class="Normal">(<span class="PreProc">!cacheableStore.has(cache</span><span class="Normal">)<span class="typescriptObjectLiteral">) {
				</span><span class="Statement">cacheableStore</span><span class="typescriptObjectLiteral">.<span class="Statement">set</span><span class="Normal">(<span class="PreProc">cache</span><span class="Operator">,<span class="PreProc"> new CacheableRequest(
					((requestOptions</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">RequestOptions</span><span class="Operator">,<span class="PreProc"> handler?</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">(<span class="Special">response</span><span class="typescriptTypeAnnotation">:<span class="Special"> <span class="Normal">IncomingMessage) </span><span class="Function">=></span><span class="PreProc"> <span class="Type">void</span><span class="Normal">)<span class="typescriptReturnAnnotation">: </span><span class="Normal">ClientRequest</span><span class="typescriptReturnAnnotation"> => </span><span class="Normal">(requestOptions</span><span class="typescriptParenthesizedType"> <span class="Normal">as</span><span class="typescriptParenthesizedType"> <span class="Normal">Pick</span><span class="typescriptTypeBrackets"><<span class="Normal">NormalizedOptions</span><span class="typescriptTypeArguments">, </span><span class="Statement">typeof</span><span class="typescriptTypeArguments"> <span class="Normal">kRequest</span><span class="typescriptTypeBrackets">><span class="Normal">)<span class="typescriptTypeBracket">[kRequest]</span><span class="Normal">(requestOptions</span><span class="typescriptParenthesizedType">, </span><span class="Normal">handler)</span><span class="typescriptReturnAnnotation">) </span><span class="Normal">as</span><span class="typescriptReturnAnnotation"> <span class="Normal">HttpRequestFunction</span><span class="typescriptReturnAnnotation">,
					</span><span class="Normal">cache</span><span class="typescriptReturnAnnotation"> <span class="Normal">as</span><span class="typescriptReturnAnnotation"> <span class="Normal">CacheableRequest.StorageAdapter</span>
<span class="typescriptReturnAnnotation">				));
			}
		}</span>
<span class="Normal">
<span class="typescriptReturnAnnotation">		// `</span><span class="Normal">options.dnsCache</span><span class="typescriptReturnAnnotation">`
		</span><span class="Normal">if</span><span class="typescriptReturnAnnotation"> <span class="Normal">(options.dnsCache</span><span class="typescriptParenthesizedType"> === </span><span class="Normal">true)</span><span class="typescriptReturnAnnotation"> <span class="Function">{
<span class="typescriptBlock">			options</span><span class="typescriptDotNotation">.<span class="typescriptBlock">dnsCache </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> CacheableLookup</span><span class="Normal">()</span><span class="typescriptBlock">;
		</span><span class="Function">}<span class="typescriptObjectLiteral"> <span class="Statement">else if </span><span class="Normal">(<span class="PreProc">!is.undefined(options.dnsCache</span><span class="Normal">)<span class="typescriptObjectLiteral"> && </span><span class="Statement">options</span><span class="typescriptObjectLiteral">.<span class="Statement">dnsCache </span><span class="typescriptObjectLiteral">!== </span><span class="Statement">false </span><span class="typescriptObjectLiteral">&& !(</span><span class="Statement">options</span><span class="typescriptObjectLiteral">.<span class="Statement">dnsCache instanceof CacheableLookup</span><span class="typescriptObjectLiteral">)) {
			</span><span class="Statement">throw new TypeError</span><span class="Normal">(<span class="PreProc">`Parameter \`dnsCache\` must be a CacheableLookup instance or a boolean</span><span class="Operator">,<span class="PreProc"> got ${is(options.dnsCache</span><span class="Normal">)<span class="Function">}<span class="Constant">`);
		}</span>
<span class="Normal">
<span class="Constant">		// `</span><span class="typescriptTernary">options</span><span class="typescriptDotNotation">.<span class="Statement">timeout</span><span class="Constant">`
		if (is.number(options.timeout)) {
			options.timeout = {request: options.timeout};
		} else if (defaults && options.timeout !== defaults.timeout) {
			options.timeout = {
				...defaults.timeout,
				...options.timeout
			};
		} else {
			options.timeout = {...options.timeout};
		}</span>
<span class="Normal">
<span class="Constant">		// `</span><span class="typescriptTernary">options</span><span class="typescriptDotNotation">.<span class="Statement">context</span><span class="Constant">`
		if (!options.context) {
			options.context = {};
		}</span>
<span class="Normal">
<span class="Constant">		// `</span><span class="typescriptTernary">options</span><span class="typescriptDotNotation">.<span class="typescriptTernary">hooks</span><span class="Constant">`
		const areHooksUserDefined = options.hooks !== defaults?.hooks;
		options.hooks = {...options.hooks};</span>
<span class="Normal">
<span class="Constant">		for (const event of knownHookEvents) {
			if (event in options.hooks) {
				if (is.array(options.hooks[event])) {
					// See https://github.com/microsoft/TypeScript/issues/31445#issuecomment-576929044
					(options.hooks as any)[event] = [...options.hooks[event]!];
				} else {
					throw new TypeError(`</span><span class="typescriptTernary">Parameter \</span><span class="Constant">`<span class="Statement">${</span><span class="typescriptTemplateSubstitution">event</span><span class="Statement">}<span class="Constant">\` must be an Array, got </span><span class="Statement">${</span><span class="typescriptTemplateSubstitution">is</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">hooks</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">event</span><span class="typescriptFuncCallArg">]<span class="Normal">)<span class="Statement">}<span class="Constant">`<span class="typescriptTernary">);
				}
			} else </span><span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Statement">options</span><span class="typescriptObjectLiteral">.<span class="Statement">hooks</span><span class="Function">[<span class="typescriptComputedPropertyName">event</span><span class="Function">]<span class="typescriptObjectLiteral"> = </span><span class="Function">[]</span><span class="typescriptObjectLiteral">;
			</span><span class="Function">}
<span class="typescriptTernary">		}</span>
<span class="Normal">
<span class="typescriptTernary">		if </span><span class="Normal">(<span class="typescriptFuncCallArg">defaults </span><span class="typescriptBinaryOp">&&</span><span class="typescriptFuncCallArg"> areHooksUserDefined</span><span class="Normal">)<span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">for </span><span class="Normal">(<span class="PreProc">const event of knownHookEvents</span><span class="Normal">)<span class="typescriptObjectLiteral"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">defaultHooks</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> defaults</span><span class="typescriptDotNotation">.<span class="typescriptBlock">hooks</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">event</span><span class="typescriptBlock">];</span>
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">defaultHooks</span><span class="typescriptDotNotation">.<span class="Statement">length</span><span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">!==</span><span class="typescriptConditionalParen"> <span class="Constant">0<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Comment">// See https://github.com/microsoft/TypeScript/issues/31445#issuecomment-576929044</span>
<span class="typescriptBlock">					</span><span class="Normal">(<span class="typescriptParenExp">options</span><span class="typescriptDotNotation">.<span class="typescriptParenExp">hooks </span><span class="Special">as</span><span class="typescriptParenExp"> <span class="Type">any</span><span class="Normal">)<span class="Function">[<span class="typescriptArray">event</span><span class="Function">]<span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Function">[
<span class="typescriptArray">						</span><span class="typescriptObjectSpread">...</span><span class="typescriptArray">defaults</span><span class="typescriptDotNotation">.<span class="typescriptArray">hooks</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">event</span><span class="Function">]<span class="typescriptBlock">,
						...options</span><span class="typescriptDotNotation">.<span class="typescriptBlock">hooks</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">event</span><span class="typescriptBlock">]<span class="typescriptUnaryOp">!
<span class="typescriptBlock">					];
				</span><span class="Function">}
<span class="typescriptBlock">			</span><span class="Function">}
<span class="typescriptObjectLiteral">		</span><span class="Function">}
<span class="Normal">
<span class="typescriptTernary">		</span><span class="Comment">// Other options</span>
<span class="typescriptTernary">		if </span><span class="Normal">(<span class="Constant">'followRedirects'</span><span class="typescriptFuncCallArg"> in options</span><span class="Normal">)<span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">throw new TypeError</span><span class="Normal">(<span class="PreProc">'The `followRedirects` option does not exist. Use `followRedirect` instead.'</span><span class="Normal">)<span class="typescriptObjectLiteral">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptTernary">		if </span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">agent</span><span class="Normal">)<span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">for </span><span class="Normal">(<span class="PreProc">const key in options.agent</span><span class="Normal">)<span class="typescriptObjectLiteral"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">key </span><span class="typescriptBinaryOp">!==</span><span class="typescriptConditionalParen"> <span class="Constant">'http'</span><span class="typescriptConditionalParen"> && key </span><span class="typescriptBinaryOp">!==</span><span class="typescriptConditionalParen"> <span class="Constant">'https'</span><span class="typescriptConditionalParen"> && key </span><span class="typescriptBinaryOp">!==</span><span class="typescriptConditionalParen"> <span class="Constant">'http2'</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Special">throw</span><span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> <span class="Type">TypeError</span><span class="Normal">(<span class="Constant">`Expected the \`options.agent\` properties to be \`http\`, \`https\` or \`http2\`, got \`</span><span class="Statement">${</span><span class="typescriptTemplateSubstitution">key</span><span class="Statement">}<span class="Constant">\``</span><span class="Normal">)<span class="typescriptBlock">;
				</span><span class="Function">}
<span class="typescriptBlock">			</span><span class="Function">}
<span class="typescriptObjectLiteral">		</span><span class="Function">}
<span class="Normal">
<span class="typescriptTernary">		options</span><span class="typescriptDotNotation">.<span class="typescriptTernary">maxRedirects </span><span class="typescriptAssign">=<span class="typescriptTernary"> options</span><span class="typescriptDotNotation">.<span class="typescriptTernary">maxRedirects </span><span class="typescriptTernaryOp">?<span class="typescriptTernary">? </span><span class="Constant">0<span class="typescriptTernary">;
<span class="Normal">
<span class="typescriptTernary">		</span><span class="Comment">// Set non-enumerable properties</span>
<span class="typescriptTernary">		setNonEnumerableProperties</span><span class="Normal">(<span class="Function">[<span class="typescriptArray">defaults, options</span><span class="Function">]<span class="typescriptFuncCallArg">, options</span><span class="Normal">)<span class="typescriptTernary">;
<span class="Normal">
<span class="typescriptTernary">		return options </span><span class="Special">as</span><span class="typescriptTernary"> <span class="Normal">NormalizedOptions</span><span class="typescriptTernary">;
	}</span>
<span class="Normal">
<span class="typescriptTernary">	_lockWrite</span><span class="Normal">()</span><span class="typescriptTernaryOp">:<span class="typescriptTernary"> <span class="Normal">void</span><span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">		</span><span class="Statement">const onLockedWrite </span><span class="typescriptObjectLiteral">= (): </span><span class="Statement">never </span><span class="typescriptObjectLiteral">=> {
			</span><span class="Statement">throw new TypeError</span><span class="Normal">(<span class="PreProc">'The payload has been already provided'</span><span class="Normal">)<span class="typescriptObjectLiteral">;
		</span><span class="Function">}<span class="typescriptTernary">;
<span class="Normal">
<span class="typescriptTernary">		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="Statement">write</span><span class="typescriptTernary"> <span class="typescriptAssign">=<span class="typescriptTernary"> onLockedWrite;
		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptTernary">end </span><span class="typescriptAssign">=<span class="typescriptTernary"> onLockedWrite;
	}</span>
<span class="Normal">
<span class="typescriptTernary">	_unlockWrite</span><span class="Normal">()</span><span class="typescriptTernaryOp">:<span class="typescriptTernary"> <span class="Normal">void</span><span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">		</span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">write </span><span class="typescriptObjectLiteral">= </span><span class="Statement">super</span><span class="typescriptObjectLiteral">.<span class="Statement">write</span><span class="typescriptObjectLiteral">;
		</span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">end </span><span class="typescriptObjectLiteral">= </span><span class="Statement">super</span><span class="typescriptObjectLiteral">.<span class="Statement">end</span><span class="typescriptObjectLiteral">;
	</span><span class="Function">}
<span class="Normal">
<span class="typescriptTernary">	<span class="Statement">async</span><span class="typescriptTernary"> _finalizeBody</span><span class="Normal">()</span><span class="typescriptTernaryOp">:<span class="Normal"> <span class="Type">Promise</span><span class="typescriptTypeBrackets"><<span class="Type">void</span><span class="typescriptTypeBrackets">><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="Function">{<span class="typescriptBlock">options</span><span class="Function">}<span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptBlock">;
		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="Function">{<span class="typescriptBlock">headers</span><span class="Function">}<span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> options;</span>
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">isForm</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="typescriptUnaryOp">!<span class="typescriptBlock">is</span><span class="typescriptDotNotation">.<span class="typescriptBlock">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">form</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">isJSON</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="typescriptUnaryOp">!<span class="typescriptBlock">is</span><span class="typescriptDotNotation">.<span class="typescriptBlock">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">json</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">isBody</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="typescriptUnaryOp">!<span class="typescriptBlock">is</span><span class="typescriptDotNotation">.<span class="typescriptBlock">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="Statement">body</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">hasPayload</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> isForm </span><span class="typescriptBinaryOp">||</span><span class="typescriptBlock"> isJSON </span><span class="typescriptBinaryOp">||</span><span class="typescriptBlock"> isBody;
		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">cannotHaveBody</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> withoutBody</span><span class="typescriptDotNotation">.<span class="Statement">has</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="Statement">method</span><span class="Normal">)<span class="typescriptBlock"> <span class="typescriptBinaryOp">&&</span><span class="typescriptBlock"> <span class="typescriptUnaryOp">!<span class="Normal">(<span class="typescriptParenExp">options</span><span class="typescriptDotNotation">.<span class="Statement">method</span><span class="typescriptParenExp"> <span class="typescriptBinaryOp">===</span><span class="typescriptParenExp"> <span class="Constant">'GET'</span><span class="typescriptParenExp"> && options</span><span class="typescriptDotNotation">.<span class="typescriptParenExp">allowGetBody</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_cannotHaveBody </span><span class="typescriptAssign">=<span class="typescriptBlock"> cannotHaveBody;</span>
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">hasPayload</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">cannotHaveBody</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Special">throw</span><span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> <span class="Type">TypeError</span><span class="Normal">(<span class="Constant">`The \`</span><span class="Statement">${</span><span class="typescriptTemplateSubstitution">options</span><span class="typescriptDotNotation">.<span class="Statement">method}</span><span class="Constant">\` method cannot be used with a body`</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Function">[<span class="typescriptArray">isBody, isForm, isJSON</span><span class="Function">]<span class="typescriptDotNotation">.<span class="Statement">filter</span><span class="Normal">(<span class="PreProc">isTrue</span><span class="typescriptArrowFuncDef"> <span class="Type">=></span><span class="typescriptFuncCallArg"> isTrue</span><span class="Normal">)<span class="typescriptDotNotation">.<span class="Statement">length</span><span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">><span class="typescriptConditionalParen"> <span class="Constant">1<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Special">throw</span><span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> <span class="Type">TypeError</span><span class="Normal">(<span class="Constant">'The `body`, `json` and `form` options are mutually exclusive'</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(
<span class="typescriptConditionalParen">				isBody </span><span class="typescriptBinaryOp">&&</span>
<span class="typescriptConditionalParen">				</span><span class="typescriptUnaryOp">!<span class="Normal">(<span class="typescriptParenExp">options</span><span class="typescriptDotNotation">.<span class="Statement">body</span><span class="typescriptParenExp"> <span class="Normal">instanceof</span><span class="typescriptParenExp"> Readable</span><span class="Normal">)<span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span>
<span class="typescriptConditionalParen">				</span><span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">string</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="Statement">body</span><span class="Normal">)<span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span>
<span class="typescriptConditionalParen">				</span><span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">buffer</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="Statement">body</span><span class="Normal">)<span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span>
<span class="typescriptConditionalParen">				</span><span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">isFormData</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="Statement">body</span><span class="Normal">)
<span class="typescriptConditionalParen">			</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Special">throw</span><span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> <span class="Type">TypeError</span><span class="Normal">(<span class="Constant">'The `body` option must be a stream.Readable, string or Buffer'</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">isForm </span><span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> <span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">object</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">form</span><span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Special">throw</span><span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> <span class="Type">TypeError</span><span class="Normal">(<span class="Constant">'The `form` option must be an Object'</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Function">{
<span class="typescriptBlock">				</span><span class="Comment">// Serialize body</span>
<span class="typescriptBlock">				</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">noContentType</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="typescriptUnaryOp">!<span class="typescriptBlock">is</span><span class="typescriptDotNotation">.<span class="typescriptBlock">string</span><span class="Normal">(<span class="typescriptFuncCallArg">headers</span><span class="typescriptProperty">[<span class="Constant">'content-type'</span><span class="typescriptFuncCallArg">]<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">isBody</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Comment">// Special case for https://github.com/form-data/form-data</span>
<span class="typescriptBlock">					</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">isFormData</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="Statement">body</span><span class="Normal">)<span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> noContentType</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">						headers</span><span class="typescriptProperty">[<span class="Constant">'content-type'</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">`multipart/form-data; boundary=</span><span class="Statement">${</span><span class="typescriptTemplateSubstitution">options</span><span class="typescriptDotNotation">.<span class="Statement">body</span><span class="typescriptDotNotation">.<span class="typescriptTemplateSubstitution">getBoundary</span><span class="Normal">()</span><span class="Statement">}<span class="Constant">`<span class="typescriptBlock">;
					</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">					</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kBody</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="Statement">body</span><span class="typescriptBlock">;
				</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">isForm</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">noContentType</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">						headers</span><span class="typescriptProperty">[<span class="Constant">'content-type'</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">'application/x-www-form-urlencoded'</span><span class="typescriptBlock">;
					</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">					</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kBody</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">(new</span><span class="typescriptParenExp"> <span class="Type">URLSearchParams</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">form </span><span class="Special">as</span><span class="typescriptFuncCallArg"> <span class="Normal">Record</span><span class="typescriptTypeBrackets"><<span class="Type">string</span><span class="typescriptTypeArguments">, </span><span class="Type">string</span><span class="typescriptTypeBrackets">><span class="Normal">))</span><span class="typescriptBlock">.toString</span><span class="Normal">()</span><span class="typescriptBlock">;
				</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">noContentType</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">						headers</span><span class="typescriptProperty">[<span class="Constant">'content-type'</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">'application/json'</span><span class="typescriptBlock">;
					</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">					</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kBody</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">JSON</span><span class="typescriptGlobalJSONDot">.<span class="Statement">stringify</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">json</span><span class="Normal">)<span class="typescriptBlock">;
				</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">uploadBodySize</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Statement">await</span><span class="typescriptBlock"> getBodySize</span><span class="Normal">(<span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kBody</span><span class="typescriptFuncCallArg">], options</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Comment">// See https://tools.ietf.org/html/rfc7230#section-3.3.2</span>
<span class="typescriptBlock">				</span><span class="Comment">// A user agent SHOULD send a Content-Length in a request message when</span>
<span class="typescriptBlock">				</span><span class="Comment">// no Transfer-Encoding is sent and the request method defines a meaning</span>
<span class="typescriptBlock">				</span><span class="Comment">// for an enclosed payload body.  For example, a Content-Length header</span>
<span class="typescriptBlock">				</span><span class="Comment">// field is normally sent in a POST request even when the value is 0</span>
<span class="typescriptBlock">				</span><span class="Comment">// (indicating an empty payload body).  A user agent SHOULD NOT send a</span>
<span class="typescriptBlock">				</span><span class="Comment">// Content-Length header field when the request message does not contain</span>
<span class="typescriptBlock">				</span><span class="Comment">// a payload body and the method semantics do not anticipate such a</span>
<span class="typescriptBlock">				</span><span class="Comment">// body.</span>
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">headers</span><span class="typescriptProperty">[<span class="Constant">'content-length'</span><span class="typescriptFuncCallArg">]<span class="Normal">)<span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">headers</span><span class="typescriptProperty">[<span class="Constant">'transfer-encoding'</span><span class="typescriptFuncCallArg">]<span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">cannotHaveBody </span><span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> <span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">uploadBodySize</span><span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">						headers</span><span class="typescriptProperty">[<span class="Constant">'content-length'</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">String</span><span class="Normal">(<span class="typescriptFuncCallArg">uploadBodySize</span><span class="Normal">)<span class="typescriptBlock">;
					</span><span class="Function">}
<span class="typescriptBlock">				</span><span class="Function">}
<span class="typescriptBlock">			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">cannotHaveBody</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_lockWrite</span><span class="Normal">()</span><span class="typescriptBlock">;
		</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_unlockWrite</span><span class="Normal">()</span><span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kBodySize</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">Number</span><span class="Normal">(<span class="typescriptFuncCallArg">headers</span><span class="typescriptProperty">[<span class="Constant">'content-length'</span><span class="typescriptFuncCallArg">]<span class="Normal">)<span class="typescriptBlock"> <span class="typescriptBinaryOp">||</span><span class="typescriptBlock"> <span class="Constant">undefined</span><span class="typescriptBlock">;
	</span><span class="Function">}
<span class="Normal">
	</span><span class="Statement">async</span><span class="Normal"> _onResponse(</span><span class="typescriptFuncCallArg">response: IncomingMessage</span><span class="Normal">): </span><span class="Type">Promise</span><span class="typescriptTypeBrackets"><<span class="Type">void</span><span class="typescriptTypeBrackets">><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="Function">{<span class="typescriptBlock">options</span><span class="Function">}<span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptBlock">;
		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="Function">{<span class="typescriptBlock">url</span><span class="Function">}<span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> options;</span>
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">decompress</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			response </span><span class="typescriptAssign">=<span class="typescriptBlock"> decompressResponse</span><span class="Normal">(<span class="typescriptFuncCallArg">response</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">statusCode</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">statusCode!;
		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">typedResponse</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> response </span><span class="Special">as</span><span class="typescriptBlock"> <span class="Normal">Response</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		typedResponse</span><span class="typescriptDotNotation">.<span class="typescriptBlock">statusMessage </span><span class="typescriptAssign">=<span class="typescriptBlock"> typedResponse</span><span class="typescriptDotNotation">.<span class="typescriptBlock">statusMessage </span><span class="typescriptTernaryOp">?<span class="typescriptTernary"> typedResponse</span><span class="typescriptDotNotation">.<span class="typescriptTernary">statusMessage </span><span class="typescriptTernaryOp">:<span class="typescriptBlock"> http</span><span class="typescriptDotNotation">.<span class="typescriptBlock">STATUS_CODES</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">statusCode</span><span class="typescriptBlock">];
		typedResponse</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="typescriptDotNotation">.<span class="Statement">toString</span><span class="Normal">()</span><span class="typescriptBlock">;
		typedResponse</span><span class="typescriptDotNotation">.<span class="typescriptBlock">requestUrl </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">requestUrl;
		typedResponse</span><span class="typescriptDotNotation">.<span class="typescriptBlock">redirectUrls </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">redirects;
		typedResponse</span><span class="typescriptDotNotation">.<span class="typescriptBlock">request </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptBlock">;
		typedResponse</span><span class="typescriptDotNotation">.<span class="typescriptBlock">isFromCache </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">(<span class="typescriptParenExp">response </span><span class="Special">as</span><span class="typescriptParenExp"> <span class="Type">any</span><span class="Normal">)<span class="typescriptBlock">.fromCache </span><span class="typescriptBinaryOp">||</span><span class="typescriptBlock"> <span class="Constant">false</span><span class="typescriptBlock">;
		typedResponse</span><span class="typescriptDotNotation">.<span class="typescriptBlock">ip </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">ip;</span>
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kIsFromCache</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> typedResponse</span><span class="typescriptDotNotation">.<span class="typescriptBlock">isFromCache;</span>
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kResponseSize</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">Number</span><span class="Normal">(<span class="typescriptFuncCallArg">response</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="typescriptProperty">[<span class="Constant">'content-length'</span><span class="typescriptFuncCallArg">]<span class="Normal">)<span class="typescriptBlock"> <span class="typescriptBinaryOp">||</span><span class="typescriptBlock"> <span class="Constant">undefined</span><span class="typescriptBlock">;
		</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kResponse</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> response;</span>
<span class="Normal">
<span class="typescriptBlock">		response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">once</span><span class="Normal">(<span class="Constant">'end'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kResponseSize</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kDownloadedSize</span><span class="typescriptBlock">];
			</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">emit</span><span class="Normal">(<span class="Constant">'downloadProgress'</span><span class="typescriptFuncCallArg">, </span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">downloadProgress</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">on</span><span class="Normal">(<span class="Constant">'error'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">(<span class="PreProc">error</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Error)</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_beforeError</span><span class="Normal">(new</span><span class="typescriptFuncCallArg"> ReadError</span><span class="Normal">(<span class="typescriptFuncCallArg">error, </span><span class="Type">this</span><span class="Normal">))</span><span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">once</span><span class="Normal">(<span class="Constant">'aborted'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">aborted</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Statement">return</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_beforeError</span><span class="Normal">(new</span><span class="typescriptFuncCallArg"> ReadError</span><span class="Normal">(<span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Statement">name</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Constant">'Error'</span><span class="typescriptObjectLiteral">,
				</span><span class="Statement">message</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Constant">'The server aborted the pending request'</span>
<span class="typescriptObjectLiteral">			</span><span class="Function">}<span class="typescriptFuncCallArg">, </span><span class="Type">this</span><span class="Normal">))</span><span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">emit</span><span class="Normal">(<span class="Constant">'downloadProgress'</span><span class="typescriptFuncCallArg">, </span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">downloadProgress</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">rawCookies</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> response</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="typescriptProperty">[<span class="Constant">'set-cookie'</span><span class="typescriptBlock">];
		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">object</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">cookieJar</span><span class="Normal">)<span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> rawCookies</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Normal">let</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">promises</span><span class="typescriptTypeAnnotation">:<span class="typescriptBlock"> <span class="Normal">Array</span><span class="typescriptTypeBrackets"><<span class="Normal">Promise</span><span class="typescriptTypeBrackets"><<span class="Type">unknown</span><span class="typescriptTypeBrackets">>></span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> rawCookies</span><span class="typescriptDotNotation">.<span class="Statement">map</span><span class="Normal">(<span class="Statement">async</span><span class="typescriptFuncCallArg"> <span class="Normal">(<span class="PreProc">rawCookie</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Type">string</span><span class="Normal">)<span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Normal">(<span class="typescriptParenExp">options</span><span class="typescriptDotNotation">.<span class="typescriptParenExp">cookieJar </span><span class="Special">as</span><span class="typescriptParenExp"> <span class="Normal">PromiseCookieJar)</span><span class="typescriptFuncCallArg">.setCookie</span><span class="Normal">(<span class="typescriptFuncCallArg">rawCookie, url</span><span class="typescriptDotNotation">.<span class="Statement">toString</span><span class="Normal">()))</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">ignoreInvalidCookies</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				promises </span><span class="typescriptAssign">=<span class="typescriptBlock"> promises</span><span class="typescriptDotNotation">.<span class="Statement">map</span><span class="Normal">(<span class="Statement">async</span><span class="typescriptFuncCallArg"> <span class="PreProc">p<span class="typescriptArrowFuncDef"> <span class="Type">=></span><span class="typescriptFuncCallArg"> p</span><span class="typescriptDotNotation">.<span class="Statement">catch</span><span class="Normal">(()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{}</span><span class="Normal">))</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Special">try</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Statement">await</span><span class="typescriptBlock"> <span class="Type">Promise</span><span class="typescriptGlobalPromiseDot">.<span class="Statement">all</span><span class="Normal">(<span class="typescriptFuncCallArg">promises</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}<span class="typescriptBlock"> <span class="Special">catch</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptParenExp">error</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_beforeError</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="Normal">)<span class="typescriptBlock">;
				</span><span class="Statement">return</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">followRedirect </span><span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> response</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="typescriptDotNotation">.<span class="Statement">location</span><span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> redirectCodes</span><span class="typescriptDotNotation">.<span class="Statement">has</span><span class="Normal">(<span class="typescriptFuncCallArg">statusCode</span><span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Comment">// We're being redirected, we don't care about the response.</span>
<span class="typescriptBlock">			</span><span class="Comment">// It'd be besto to abort the request, but we can't because</span>
<span class="typescriptBlock">			</span><span class="Comment">// we would have to sacrifice the TCP connection. We don't want that.</span>
<span class="typescriptBlock">			response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">resume</span><span class="Normal">()</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="typescriptConditionalParen">]<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kCancelTimeouts</span><span class="typescriptBlock">]<span class="typescriptUnaryOp">!<span class="Normal">()</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Comment">// eslint-disable-next-line @typescript-eslint/no-dynamic-delete</span>
<span class="typescriptBlock">				</span><span class="Normal">delete</span><span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="typescriptBlock">];
				</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kUnproxyEvents</span><span class="typescriptBlock">]<span class="Normal">()</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">shouldBeGet</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> statusCode </span><span class="typescriptBinaryOp">===</span><span class="typescriptBlock"> <span class="Constant">303</span><span class="typescriptBlock"> <span class="typescriptBinaryOp">&&</span><span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="Statement">method</span><span class="typescriptBlock"> <span class="typescriptBinaryOp">!==</span><span class="typescriptBlock"> <span class="Constant">'GET'</span><span class="typescriptBlock"> && options</span><span class="typescriptDotNotation">.<span class="Statement">method</span><span class="typescriptBlock"> <span class="typescriptBinaryOp">!==</span><span class="typescriptBlock"> <span class="Constant">'HEAD'</span><span class="typescriptBlock">;
			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">shouldBeGet </span><span class="typescriptBinaryOp">||</span><span class="typescriptConditionalParen"> <span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">methodRewriting</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Comment">// Server responded with "see other", indicating that the resource exists at another location,</span>
<span class="typescriptBlock">				</span><span class="Comment">// and the client should request it from that location via GET or HEAD.</span>
<span class="typescriptBlock">				options</span><span class="typescriptDotNotation">.<span class="Statement">method</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">'GET'</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Constant">'body'</span><span class="typescriptConditionalParen"> in options</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Normal">delete</span><span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="Statement">body</span><span class="typescriptBlock">;
				</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Constant">'json'</span><span class="typescriptConditionalParen"> in options</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Normal">delete</span><span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="typescriptBlock">json;
				</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Constant">'form'</span><span class="typescriptConditionalParen"> in options</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Normal">delete</span><span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="typescriptBlock">form;
				</span><span class="Function">}
<span class="typescriptBlock">			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">redirects</span><span class="typescriptDotNotation">.<span class="Statement">length</span><span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">>=</span><span class="typescriptConditionalParen"> options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">maxRedirects</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_beforeError</span><span class="Normal">(new</span><span class="typescriptFuncCallArg"> MaxRedirectsError</span><span class="Normal">(<span class="Type">this</span><span class="Normal">))</span><span class="typescriptBlock">;
				</span><span class="Statement">return</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Special">try</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Comment">// Handles invalid URLs. See https://github.com/sindresorhus/got/issues/604</span>
<span class="typescriptBlock">				</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">redirectBuffer</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">Buffer</span><span class="typescriptDotNotation">.<span class="typescriptBlock">from</span><span class="Normal">(<span class="typescriptFuncCallArg">response</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="typescriptDotNotation">.<span class="Statement">location</span><span class="typescriptFuncCallArg">, </span><span class="Constant">'binary'</span><span class="Normal">)<span class="typescriptDotNotation">.<span class="Statement">toString</span><span class="Normal">()</span><span class="typescriptBlock">;
				</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">redirectUrl</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> <span class="Type">URL</span><span class="Normal">(<span class="typescriptFuncCallArg">redirectBuffer, url</span><span class="Normal">)<span class="typescriptBlock">;
				</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">redirectString</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> redirectUrl</span><span class="typescriptDotNotation">.<span class="Statement">toString</span><span class="Normal">()</span><span class="typescriptBlock">;
				</span><span class="Type">decodeURI</span><span class="Normal">(<span class="typescriptFuncCallArg">redirectString</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Comment">// Redirecting to a different site, clear sensitive data.</span>
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">redirectUrl</span><span class="typescriptDotNotation">.<span class="Statement">hostname</span><span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">!==</span><span class="typescriptConditionalParen"> url</span><span class="typescriptDotNotation">.<span class="Statement">hostname</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Constant">'cookie'</span><span class="typescriptConditionalParen"> in options</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">						</span><span class="Normal">delete</span><span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="typescriptDotNotation">.<span class="Statement">cookie</span><span class="typescriptBlock">;
					</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">					</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Constant">'authorization'</span><span class="typescriptConditionalParen"> in options</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">						</span><span class="Normal">delete</span><span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="typescriptDotNotation">.<span class="typescriptBlock">authorization;
					</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">					</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">options</span><span class="typescriptDotNotation">.<span class="Statement">username</span><span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">||</span><span class="typescriptConditionalParen"> options</span><span class="typescriptDotNotation">.<span class="Statement">password</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">						</span><span class="Normal">delete</span><span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="Statement">username</span><span class="typescriptBlock">;
						</span><span class="Normal">delete</span><span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="Statement">password</span><span class="typescriptBlock">;
					</span><span class="Function">}
<span class="typescriptBlock">				</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">redirects</span><span class="typescriptDotNotation">.<span class="Statement">push</span><span class="Normal">(<span class="typescriptFuncCallArg">redirectString</span><span class="Normal">)<span class="typescriptBlock">;
				options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> redirectUrl;</span>
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Statement">for</span><span class="typescriptBlock"> <span class="Normal">(const</span><span class="typescriptLoopParen"> <span class="typescriptVariableDeclaration">hook</span><span class="typescriptLoopParen"> <span class="Statement">of</span><span class="typescriptLoopParen"> options</span><span class="typescriptDotNotation">.<span class="typescriptLoopParen">hooks</span><span class="typescriptDotNotation">.<span class="typescriptLoopParen">beforeRedirect</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Comment">// eslint-disable-next-line no-await-in-loop</span>
<span class="typescriptBlock">					</span><span class="Statement">await</span><span class="typescriptBlock"> hook</span><span class="Normal">(<span class="typescriptFuncCallArg">options, typedResponse</span><span class="Normal">)<span class="typescriptBlock">;
				</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">emit</span><span class="Normal">(<span class="Constant">'redirect'</span><span class="typescriptFuncCallArg">, typedResponse, options</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Statement">await</span><span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_makeRequest</span><span class="Normal">()</span><span class="typescriptBlock">;
			</span><span class="Function">}<span class="typescriptBlock"> <span class="Special">catch</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptParenExp">error</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_beforeError</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="Normal">)<span class="typescriptBlock">;
				</span><span class="Statement">return</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">return</span><span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">limitStatusCode</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="typescriptBlock">followRedirect </span><span class="typescriptTernaryOp">?<span class="typescriptTernary"> <span class="Constant">299</span><span class="typescriptTernary"> <span class="typescriptTernaryOp">:<span class="typescriptBlock"> <span class="Constant">399</span><span class="typescriptBlock">;
		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">isOk</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">(<span class="typescriptParenExp">statusCode </span><span class="typescriptBinaryOp">>=</span><span class="typescriptParenExp"> <span class="Constant">200</span><span class="typescriptParenExp"> <span class="typescriptBinaryOp">&&</span><span class="typescriptParenExp"> statusCode </span><span class="typescriptBinaryOp"><=</span><span class="typescriptParenExp"> limitStatusCode</span><span class="Normal">)<span class="typescriptBlock"> <span class="typescriptBinaryOp">||</span><span class="typescriptBlock"> statusCode </span><span class="typescriptBinaryOp">===</span><span class="typescriptBlock"> <span class="Constant">304</span><span class="typescriptBlock">;
		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">throwHttpErrors </span><span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> <span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">isOk</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Statement">await</span><span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_beforeError</span><span class="Normal">(new</span><span class="typescriptFuncCallArg"> HTTPError</span><span class="Normal">(<span class="typescriptFuncCallArg">typedResponse</span><span class="Normal">))</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">destroyed</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Statement">return</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">on</span><span class="Normal">(<span class="Constant">'readable'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kTriggerRead</span><span class="typescriptConditionalParen">]<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_read</span><span class="Normal">()</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">on</span><span class="Normal">(<span class="Constant">'resume'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">			response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">resume</span><span class="Normal">()</span><span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">on</span><span class="Normal">(<span class="Constant">'pause'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">			response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">pause</span><span class="Normal">()</span><span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">once</span><span class="Normal">(<span class="Constant">'end'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="Statement">push</span><span class="Normal">(<span class="Constant">null</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">emit</span><span class="Normal">(<span class="Constant">'response'</span><span class="typescriptFuncCallArg">, response</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">for</span><span class="typescriptBlock"> <span class="Normal">(const</span><span class="typescriptLoopParen"> <span class="typescriptVariableDeclaration">destination</span><span class="typescriptLoopParen"> <span class="Statement">of</span><span class="typescriptLoopParen"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kServerResponsesPiped</span><span class="typescriptLoopParen">]<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">destination</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">headersSent</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Statement">continue</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Comment">// eslint-disable-next-line guard-for-in</span>
<span class="typescriptBlock">			</span><span class="Statement">for</span><span class="typescriptBlock"> <span class="Normal">(const</span><span class="typescriptLoopParen"> <span class="typescriptVariableDeclaration">key</span><span class="typescriptLoopParen"> <span class="Statement">in</span><span class="typescriptLoopParen"> response</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">isAllowed</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="typescriptBlock">decompress </span><span class="typescriptTernaryOp">?<span class="typescriptTernary"> key </span><span class="typescriptBinaryOp">!==</span><span class="typescriptTernary"> <span class="Constant">'content-encoding'</span><span class="typescriptTernary"> <span class="typescriptTernaryOp">:<span class="typescriptBlock"> <span class="Constant">true</span><span class="typescriptBlock">;
				</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">value</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> response</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">key</span><span class="typescriptBlock">];</span>
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">isAllowed</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					destination</span><span class="typescriptDotNotation">.<span class="typescriptBlock">setHeader</span><span class="Normal">(<span class="typescriptFuncCallArg">key, value</span><span class="typescriptUnaryOp">!<span class="Normal">)<span class="typescriptBlock">;
				</span><span class="Function">}
<span class="typescriptBlock">			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			destination</span><span class="typescriptDotNotation">.<span class="typescriptBlock">statusCode </span><span class="typescriptAssign">=<span class="typescriptBlock"> statusCode;
		</span><span class="Function">}
<span class="typescriptBlock">	<span class="Function">}
<span class="Normal">
	_onRequest(</span><span class="typescriptFuncCallArg">request: ClientRequest</span><span class="Normal">): void </span><span class="Function">{
<span class="typescriptObjectLiteral">		</span><span class="Statement">const </span><span class="typescriptObjectLiteral">{<span class="Statement">options</span><span class="Function">}<span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">this</span><span class="Normal">;
		const </span><span class="Function">{<span class="typescriptBlock">timeout, url</span><span class="Function">}<span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> options;

		timer(</span><span class="typescriptFuncCallArg">request</span><span class="Normal">);

		</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kCancelTimeouts</span><span class="Normal">] </span><span class="typescriptAssign">=<span class="Normal"> timedOut(</span><span class="typescriptFuncCallArg">request, timeout, url</span><span class="Normal">);

		request</span><span class="typescriptDotNotation">.<span class="Normal">once(</span><span class="Constant">'response'</span><span class="typescriptFuncCallArg">, </span><span class="PreProc">response</span><span class="typescriptArrowFuncDef"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_onResponse</span><span class="Normal">(<span class="typescriptFuncCallArg">response</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal">);

		request</span><span class="typescriptDotNotation">.<span class="Normal">once(</span><span class="Constant">'error'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">(<span class="PreProc">error</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Error)</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">error </span><span class="Normal">instanceof</span><span class="typescriptConditionalParen"> TimedOutTimeoutError</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				error </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> TimeoutError</span><span class="Normal">(<span class="typescriptFuncCallArg">error, </span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">timings!, </span><span class="Type">this</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				error </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> RequestError</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">message, error, </span><span class="Type">this</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_beforeError</span><span class="Normal">(<span class="typescriptFuncCallArg">error </span><span class="Special">as</span><span class="typescriptFuncCallArg"> <span class="Normal">RequestError)</span><span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal">);

		</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kUnproxyEvents</span><span class="Normal">] </span><span class="typescriptAssign">=<span class="Normal"> proxyEvents(</span><span class="typescriptFuncCallArg">request, </span><span class="Type">this</span><span class="typescriptFuncCallArg">, proxiedRequestEvents</span><span class="Normal">);

		</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="Normal">] </span><span class="typescriptAssign">=<span class="Normal"> request;

		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="Normal">emit(</span><span class="Constant">'uploadProgress'</span><span class="typescriptFuncCallArg">, </span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">uploadProgress</span><span class="Normal">);

		</span><span class="Comment">// Send body</span>
<span class="Normal">		const </span><span class="typescriptVariableDeclaration">body</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kBody</span><span class="Normal">];
		const </span><span class="typescriptVariableDeclaration">currentRequest</span><span class="Normal"> <span class="typescriptAssign">=<span class="Normal"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="Normal">redirects</span><span class="typescriptDotNotation">.<span class="Statement">length</span><span class="Normal"> <span class="typescriptBinaryOp">===</span><span class="Normal"> <span class="Constant">0<span class="Normal"> <span class="typescriptTernaryOp">?<span class="typescriptTernary"> <span class="Type">this</span><span class="typescriptTernary"> <span class="typescriptTernaryOp">:<span class="Normal"> request;

		</span><span class="Statement">if</span><span class="Normal"> (</span><span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">nodeStream</span><span class="Normal">(<span class="typescriptFuncCallArg">body</span><span class="Normal">)) </span><span class="Function">{
<span class="typescriptBlock">			body</span><span class="typescriptDotNotation">.<span class="typescriptBlock">pipe</span><span class="Normal">(<span class="typescriptFuncCallArg">currentRequest</span><span class="Normal">)<span class="typescriptBlock">;
			body</span><span class="typescriptDotNotation">.<span class="typescriptBlock">once</span><span class="Normal">(<span class="Constant">'error'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">(<span class="PreProc">error</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">NodeJS.ErrnoException)</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_beforeError</span><span class="Normal">(new</span><span class="typescriptFuncCallArg"> UploadError</span><span class="Normal">(<span class="typescriptFuncCallArg">error, </span><span class="Type">this</span><span class="Normal">))</span><span class="typescriptBlock">;
			</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			body</span><span class="typescriptDotNotation">.<span class="typescriptBlock">once</span><span class="Normal">(<span class="Constant">'end'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Normal">delete</span><span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="Statement">body</span><span class="typescriptBlock">;
			</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal"> <span class="Statement">else</span><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_unlockWrite</span><span class="Normal">()</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">body</span><span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_writeRequest</span><span class="Normal">(<span class="typescriptFuncCallArg">body, </span><span class="Constant">null</span><span class="typescriptFuncCallArg"> <span class="Special">as</span><span class="typescriptFuncCallArg"> <span class="Type">unknown</span><span class="typescriptFuncCallArg"> as string, </span><span class="Normal">()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{}</span><span class="Normal">)<span class="typescriptBlock">;
				currentRequest</span><span class="typescriptDotNotation">.<span class="typescriptBlock">end</span><span class="Normal">()</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_lockWrite</span><span class="Normal">()</span><span class="typescriptBlock">;
			</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">_cannotHaveBody </span><span class="typescriptBinaryOp">||</span><span class="typescriptConditionalParen"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">_noPipe</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				currentRequest</span><span class="typescriptDotNotation">.<span class="typescriptBlock">end</span><span class="Normal">()</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_lockWrite</span><span class="Normal">()</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}
<span class="Normal">
		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="Normal">emit(</span><span class="Constant">'request'</span><span class="typescriptFuncCallArg">, request</span><span class="Normal">);
	}

	</span><span class="Statement">async</span><span class="Normal"> _createCacheableRequest(</span><span class="typescriptFuncCallArg">url: </span><span class="Type">URL</span><span class="typescriptFuncCallArg">, options: RequestOptions</span><span class="Normal">): </span><span class="Type">Promise</span><span class="typescriptTypeBrackets"><<span class="Normal">ClientRequest</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Normal">ResponseLike</span><span class="typescriptTypeBrackets">><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Statement">return</span><span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> <span class="Type">Promise</span><span class="typescriptTypeBrackets"><<span class="Normal">ClientRequest</span><span class="typescriptTypeArguments"> <span class="Operator">|<span class="typescriptTypeArguments"> <span class="Normal">ResponseLike</span><span class="typescriptTypeBrackets">><span class="Normal">((</span><span class="PreProc">resolve</span><span class="Operator">,<span class="PreProc"> reject</span><span class="Normal">)<span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Comment">// </span><span class="Todo">TODO</span><span class="Comment">: Remove `utils/url-to-options.ts` when `cacheable-request` is fixed</span>
<span class="typescriptBlock">			</span><span class="Type">Object</span><span class="typescriptGlobalObjectDot">.<span class="Statement">assign</span><span class="Normal">(<span class="typescriptFuncCallArg">options, urlToOptions</span><span class="Normal">(<span class="typescriptFuncCallArg">url</span><span class="Normal">))</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Comment">// `http-cache-semantics` checks this</span>
<span class="typescriptBlock">			</span><span class="Normal">delete</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptParenExp">options </span><span class="Special">as</span><span class="typescriptParenExp"> <span class="Type">unknown</span><span class="typescriptParenExp"> <span class="Special">as</span><span class="typescriptParenExp"> <span class="Normal">NormalizedOptions)</span><span class="typescriptBlock">.url;</span>
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Comment">// This is ugly</span>
<span class="typescriptBlock">			</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">cacheRequest</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> cacheableStore</span><span class="typescriptDotNotation">.<span class="Statement">get</span><span class="Normal">((</span><span class="typescriptParenExp">options </span><span class="Special">as</span><span class="typescriptParenExp"> <span class="Type">any</span><span class="Normal">)<span class="typescriptFuncCallArg">.cache</span><span class="Normal">)<span class="typescriptUnaryOp">!<span class="Normal">(<span class="typescriptParenExp">options, resolve </span><span class="Special">as</span><span class="typescriptParenExp"> <span class="Type">any</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Comment">// Restore options</span>
<span class="typescriptBlock">			</span><span class="Normal">(<span class="typescriptParenExp">options </span><span class="Special">as</span><span class="typescriptParenExp"> <span class="Type">unknown</span><span class="typescriptParenExp"> <span class="Special">as</span><span class="typescriptParenExp"> <span class="Normal">NormalizedOptions)</span><span class="typescriptBlock">.url </span><span class="typescriptAssign">=<span class="typescriptBlock"> url;</span>
<span class="Normal">
<span class="typescriptBlock">			cacheRequest</span><span class="typescriptDotNotation">.<span class="typescriptBlock">once</span><span class="Normal">(<span class="Constant">'error'</span><span class="typescriptFuncCallArg">, </span><span class="Normal">(<span class="PreProc">error</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Error)</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">error </span><span class="Normal">instanceof</span><span class="typescriptConditionalParen"> CacheableRequest</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">CacheError</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					reject</span><span class="Normal">(new</span><span class="typescriptFuncCallArg"> CacheError</span><span class="Normal">(<span class="typescriptFuncCallArg">error, </span><span class="Type">this</span><span class="Normal">))</span><span class="typescriptBlock">;
					</span><span class="Statement">return</span><span class="typescriptBlock">;
				</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">				reject</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
			cacheRequest</span><span class="typescriptDotNotation">.<span class="typescriptBlock">once</span><span class="Normal">(<span class="Constant">'request'</span><span class="typescriptFuncCallArg">, resolve</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
	</span><span class="Function">}
<span class="Normal">
	</span><span class="Statement">async</span><span class="Normal"> _makeRequest(): </span><span class="Type">Promise</span><span class="typescriptTypeBrackets"><<span class="Type">void</span><span class="typescriptTypeBrackets">><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="Function">{<span class="typescriptBlock">options</span><span class="Function">}<span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptBlock">;
		</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="Function">{<span class="typescriptBlock">url, headers, request, agent, timeout</span><span class="Function">}<span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> options;</span>
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">for</span><span class="typescriptBlock"> <span class="Normal">(const</span><span class="typescriptLoopParen"> <span class="typescriptVariableDeclaration">key</span><span class="typescriptLoopParen"> <span class="Statement">in</span><span class="typescriptLoopParen"> headers</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">headers</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">key</span><span class="typescriptFuncCallArg">]<span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Comment">// eslint-disable-next-line @typescript-eslint/no-dynamic-delete</span>
<span class="typescriptBlock">				</span><span class="Normal">delete</span><span class="typescriptBlock"> headers</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">key</span><span class="typescriptBlock">];
			</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">null_</span><span class="Normal">(<span class="typescriptFuncCallArg">headers</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">key</span><span class="typescriptFuncCallArg">]<span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Special">throw</span><span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> <span class="Type">TypeError</span><span class="Normal">(<span class="Constant">`Use \`undefined\` instead of \`null\` to delete the \`</span><span class="Statement">${</span><span class="typescriptTemplateSubstitution">key</span><span class="Statement">}<span class="Constant">\` header`</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">decompress </span><span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">headers</span><span class="typescriptProperty">[<span class="Constant">'accept-encoding'</span><span class="typescriptFuncCallArg">]<span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			headers</span><span class="typescriptProperty">[<span class="Constant">'accept-encoding'</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> supportsBrotli </span><span class="typescriptTernaryOp">?<span class="typescriptTernary"> <span class="Constant">'gzip, deflate, br'</span><span class="typescriptTernary"> <span class="typescriptTernaryOp">:<span class="typescriptBlock"> <span class="Constant">'gzip, deflate'</span><span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Comment">// Set cookies</span>
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">cookieJar</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">cookieString</span><span class="typescriptTypeAnnotation">:<span class="typescriptBlock"> <span class="Type">string</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Statement">await</span><span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="typescriptBlock">cookieJar</span><span class="typescriptDotNotation">.<span class="typescriptBlock">getCookieString</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="Statement">url</span><span class="typescriptDotNotation">.<span class="Statement">toString</span><span class="Normal">())</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">nonEmptyString</span><span class="Normal">(<span class="typescriptFuncCallArg">cookieString</span><span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				options</span><span class="typescriptDotNotation">.<span class="Statement">headers</span><span class="typescriptDotNotation">.<span class="Statement">cookie</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> cookieString;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">for</span><span class="typescriptBlock"> <span class="Normal">(const</span><span class="typescriptLoopParen"> <span class="typescriptVariableDeclaration">hook</span><span class="typescriptLoopParen"> <span class="Statement">of</span><span class="typescriptLoopParen"> options</span><span class="typescriptDotNotation">.<span class="typescriptLoopParen">hooks</span><span class="typescriptDotNotation">.<span class="typescriptLoopParen">beforeRequest</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Comment">// eslint-disable-next-line no-await-in-loop</span>
<span class="typescriptBlock">			</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">result</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Statement">await</span><span class="typescriptBlock"> hook</span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">result</span><span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Comment">// @ts-ignore Skip the type mismatch to support abstract responses</span>
<span class="typescriptBlock">				options</span><span class="typescriptDotNotation">.<span class="typescriptBlock">request </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">()</span><span class="PreProc"> <span class="Type">=></span><span class="typescriptBlock"> result;
				</span><span class="Statement">break</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">dnsCache </span><span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> <span class="typescriptUnaryOp">!<span class="Normal">(<span class="Constant">'lookup'</span><span class="typescriptParenExp"> in options</span><span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			options</span><span class="typescriptDotNotation">.<span class="typescriptBlock">lookup </span><span class="typescriptAssign">=<span class="typescriptBlock"> options</span><span class="typescriptDotNotation">.<span class="typescriptBlock">dnsCache</span><span class="typescriptDotNotation">.<span class="typescriptBlock">lookup;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Comment">// UNIX sockets</span>
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">url</span><span class="typescriptDotNotation">.<span class="Statement">hostname</span><span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">===</span><span class="typescriptConditionalParen"> <span class="Constant">'unix'</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">matches</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">/(?<socketPath>.+?):(?<path>.+)/</span><span class="typescriptDotNotation">.<span class="Statement">exec</span><span class="Normal">(<span class="Constant">`<span class="Statement">${</span><span class="typescriptTemplateSubstitution">url</span><span class="typescriptDotNotation">.<span class="Statement">pathname}${</span><span class="typescriptTemplateSubstitution">url</span><span class="typescriptDotNotation">.<span class="Statement">search}</span><span class="Constant">`<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">matches</span><span class="typescriptTernaryOp">?<span class="typescriptTernary">.groups) </span><span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Statement">const </span><span class="typescriptObjectLiteral">{<span class="Statement">socketPath</span><span class="typescriptObjectLiteral">, </span><span class="Statement">path</span><span class="Function">}<span class="typescriptTernary"> = matches</span><span class="typescriptDotNotation">.<span class="typescriptTernary">groups;</span>
<span class="Normal">
<span class="typescriptTernary">				</span><span class="Type">Object</span><span class="typescriptGlobalObjectDot">.<span class="Statement">assign</span><span class="Normal">(<span class="typescriptFuncCallArg">options, </span><span class="Function">{
<span class="typescriptObjectLiteral">					</span><span class="Statement">socketPath</span><span class="typescriptObjectLiteral">,
					</span><span class="Statement">path</span><span class="typescriptObjectLiteral">,
					</span><span class="Statement">host</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Constant">''</span>
<span class="typescriptObjectLiteral">				</span><span class="Function">}<span class="Normal">)<span class="typescriptTernary">;
			}
		}</span>
<span class="Normal">
<span class="typescriptTernary">		const isHttps </span><span class="typescriptAssign">=<span class="typescriptTernary"> url</span><span class="typescriptDotNotation">.<span class="Statement">protocol</span><span class="typescriptTernary"> <span class="typescriptBinaryOp">===</span><span class="typescriptTernary"> <span class="Constant">'https:'</span><span class="typescriptTernary">;
<span class="Normal">
<span class="typescriptTernary">		let fallbackFn</span><span class="typescriptTernaryOp">:<span class="typescriptConditionalParen"> HttpRequestFunction;
		if </span><span class="Normal">(<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">http2</span><span class="Normal">)<span class="typescriptConditionalParen"> <span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">fallbackFn </span><span class="typescriptObjectLiteral">= </span><span class="Statement">http2wrapper</span><span class="typescriptObjectLiteral">.<span class="Statement">auto</span><span class="typescriptObjectLiteral">;
		</span><span class="Function">}<span class="typescriptConditionalParen"> else </span><span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">fallbackFn </span><span class="typescriptObjectLiteral">= </span><span class="Statement">isHttps </span><span class="typescriptObjectLiteral">? </span><span class="Statement">https</span><span class="typescriptObjectLiteral">.<span class="Statement">request </span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> http</span><span class="typescriptDotNotation">.<span class="typescriptObjectLiteral">request;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptConditionalParen">		const realFn </span><span class="typescriptAssign">=<span class="typescriptConditionalParen"> options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">request </span><span class="typescriptTernaryOp">?<span class="typescriptTernary">? fallbackFn;
		const fn </span><span class="typescriptAssign">=<span class="typescriptTernary"> options</span><span class="typescriptDotNotation">.<span class="Statement">cache</span><span class="typescriptTernary"> <span class="typescriptTernaryOp">?<span class="typescriptTernary"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptTernary">_createCacheableRequest</span><span class="typescriptDotNotation">.<span class="Statement">bind</span><span class="Normal">(<span class="Type">this</span><span class="Normal">)<span class="typescriptTernary"> <span class="typescriptTernaryOp">:<span class="typescriptTernary"> realFn;</span>
<span class="Normal">
<span class="typescriptTernary">		if </span><span class="Normal">(<span class="typescriptFuncCallArg">agent </span><span class="typescriptBinaryOp">&&</span><span class="typescriptFuncCallArg"> <span class="typescriptUnaryOp">!<span class="typescriptFuncCallArg">options</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">http2</span><span class="Normal">)<span class="typescriptTernary"> <span class="Function">{
<span class="typescriptObjectLiteral">			(</span><span class="Statement">options as unknown as RequestOptions</span><span class="typescriptObjectLiteral">).</span><span class="Statement">agent </span><span class="typescriptObjectLiteral">= </span><span class="Statement">agent</span><span class="Function">[<span class="typescriptComputedPropertyName">isHttps </span><span class="typescriptTernaryOp">?<span class="typescriptTernary"> <span class="Constant">'https'</span><span class="typescriptTernary"> <span class="typescriptTernaryOp">:<span class="typescriptComputedPropertyName"> <span class="Constant">'http'</span><span class="Function">]<span class="typescriptObjectLiteral">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptTernary">		options</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="typescriptTernary">] = realFn </span><span class="Special">as</span><span class="typescriptTernary"> <span class="Normal">HttpRequestFunction</span><span class="typescriptTernary">;
		</span><span class="Normal">delete</span><span class="typescriptTernary"> options</span><span class="typescriptDotNotation">.<span class="typescriptTernary">request;
		</span><span class="Normal">delete</span><span class="typescriptTernary"> options</span><span class="typescriptDotNotation">.<span class="Statement">timeout</span><span class="typescriptTernary">;
<span class="Normal">
<span class="typescriptTernary">		let requestOrResponse</span><span class="typescriptTernaryOp">:<span class="typescriptConditionalParen"> ReturnType</span><span class="typescriptTypeBrackets"><<span class="Normal">RequestFunction</span><span class="typescriptTypeBrackets">><span class="typescriptConditionalParen">;
<span class="Normal">
<span class="typescriptConditionalParen">		try </span><span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">requestOrResponse </span><span class="typescriptObjectLiteral">= </span><span class="Statement">await fn</span><span class="Normal">(<span class="PreProc">url</span><span class="Operator">,<span class="PreProc"> options as unknown as RequestOptions</span><span class="Normal">)<span class="typescriptObjectLiteral">;
<span class="Normal">
<span class="typescriptObjectLiteral">			</span><span class="Statement">if </span><span class="Normal">(<span class="PreProc">is.undefined(requestOrResponse</span><span class="Normal">)<span class="typescriptObjectLiteral">) {
				</span><span class="Statement">requestOrResponse </span><span class="typescriptObjectLiteral">= </span><span class="Statement">fallbackFn</span><span class="Normal">(<span class="PreProc">url</span><span class="Operator">,<span class="PreProc"> options as unknown as RequestOptions</span><span class="Normal">)<span class="typescriptObjectLiteral">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptConditionalParen">			</span><span class="Comment">// Restore options</span>
<span class="typescriptConditionalParen">			options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">request </span><span class="typescriptAssign">=<span class="typescriptConditionalParen"> request;
			options</span><span class="typescriptDotNotation">.<span class="Statement">timeout</span><span class="typescriptConditionalParen"> <span class="typescriptAssign">=<span class="typescriptConditionalParen"> timeout;
			options</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">agent </span><span class="typescriptAssign">=<span class="typescriptConditionalParen"> agent;</span>
<span class="Normal">
<span class="typescriptConditionalParen">			if </span><span class="Normal">(<span class="typescriptFuncCallArg">isClientRequest</span><span class="Normal">(<span class="typescriptFuncCallArg">requestOrResponse</span><span class="Normal">))</span><span class="typescriptConditionalParen"> <span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">_onRequest</span><span class="Normal">(<span class="PreProc">requestOrResponse</span><span class="Normal">)<span class="typescriptObjectLiteral">;
<span class="Normal">
<span class="typescriptObjectLiteral">				</span><span class="Comment">// Emit the response after the stream has been ended</span>
<span class="typescriptObjectLiteral">			</span><span class="Function">}<span class="typescriptConditionalParen"> else if </span><span class="Normal">(<span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">writable</span><span class="Normal">)<span class="typescriptConditionalParen"> <span class="Function">{
<span class="typescriptObjectLiteral">				</span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">once</span><span class="Normal">(<span class="PreProc">'finish'</span><span class="Operator">,<span class="PreProc"> (</span><span class="Normal">)<span class="typescriptObjectLiteral"> => {
					</span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">_onResponse</span><span class="Normal">(<span class="PreProc">requestOrResponse as IncomingMessage</span><span class="Normal">)<span class="typescriptObjectLiteral">;
				</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_unlockWrite</span><span class="Normal">()</span><span class="typescriptBlock">;
				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">end</span><span class="Normal">()</span><span class="typescriptBlock">;
				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_lockWrite</span><span class="Normal">()</span><span class="typescriptBlock">;
			</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_onResponse</span><span class="Normal">(<span class="typescriptFuncCallArg">requestOrResponse </span><span class="Special">as</span><span class="typescriptFuncCallArg"> <span class="Normal">IncomingMessage)</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}<span class="Normal"> <span class="Special">catch</span><span class="Normal"> (</span><span class="typescriptParenExp">error</span><span class="Normal">) </span><span class="Function">{
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">error </span><span class="Normal">instanceof</span><span class="typescriptConditionalParen"> RequestError</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Special">throw</span><span class="typescriptBlock"> error;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Special">throw</span><span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> RequestError</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">message, error, </span><span class="Type">this</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">	}

	</span><span class="Statement">async</span><span class="Normal"> _beforeError(</span><span class="typescriptFuncCallArg">error: </span><span class="Type">Error</span><span class="Normal">): </span><span class="Type">Promise</span><span class="typescriptTypeBrackets"><<span class="Type">void</span><span class="typescriptTypeBrackets">><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kStopReading</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">true</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptUnaryOp">!<span class="Normal">(<span class="typescriptParenExp">error </span><span class="Normal">instanceof</span><span class="typescriptParenExp"> RequestError</span><span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			error </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> RequestError</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">message, error, </span><span class="Type">this</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Special">try</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="Function">{<span class="typescriptBlock">response</span><span class="Function">}<span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> error </span><span class="Special">as</span><span class="typescriptBlock"> <span class="Normal">RequestError</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">response</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">setEncoding</span><span class="Normal">((</span><span class="Type">this</span><span class="typescriptParenExp"> <span class="Special">as</span><span class="typescriptParenExp"> <span class="Type">any</span><span class="Normal">)<span class="typescriptFuncCallArg">._readableState</span><span class="typescriptDotNotation">.<span class="Statement">encoding</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">rawBody </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Statement">await</span><span class="typescriptBlock"> getStream</span><span class="typescriptDotNotation">.<span class="typescriptBlock">buffer</span><span class="Normal">(<span class="typescriptFuncCallArg">response</span><span class="Normal">)<span class="typescriptBlock">;
				response</span><span class="typescriptDotNotation">.<span class="Statement">body</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> response</span><span class="typescriptDotNotation">.<span class="typescriptBlock">rawBody</span><span class="typescriptDotNotation">.<span class="Statement">toString</span><span class="Normal">()</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}<span class="typescriptBlock"> <span class="Special">catch</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptParenExp">_<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{}</span>
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Special">try</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Statement">for</span><span class="typescriptBlock"> <span class="Normal">(const</span><span class="typescriptLoopParen"> <span class="typescriptVariableDeclaration">hook</span><span class="typescriptLoopParen"> <span class="Statement">of</span><span class="typescriptLoopParen"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptLoopParen">options</span><span class="typescriptDotNotation">.<span class="typescriptLoopParen">hooks</span><span class="typescriptDotNotation">.<span class="typescriptLoopParen">beforeError</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Comment">// eslint-disable-next-line no-await-in-loop</span>
<span class="typescriptBlock">				error </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Statement">await</span><span class="typescriptBlock"> hook</span><span class="Normal">(<span class="typescriptFuncCallArg">error </span><span class="Special">as</span><span class="typescriptFuncCallArg"> <span class="Normal">RequestError)</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}<span class="typescriptBlock"> <span class="Special">catch</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptParenExp">error_</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			error </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> RequestError</span><span class="Normal">(<span class="typescriptFuncCallArg">error_</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">message, error_, </span><span class="Type">this</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">destroy</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="Normal">)<span class="typescriptBlock">;
	</span><span class="Function">}
<span class="Normal">
	_read(): void </span><span class="Function">{
<span class="typescriptObjectLiteral">		</span><span class="Statement">this</span><span class="Function">[<span class="typescriptComputedPropertyName">kTriggerRead</span><span class="Function">]<span class="typescriptObjectLiteral"> = </span><span class="Statement">true</span><span class="typescriptObjectLiteral">;
<span class="Normal">
<span class="typescriptObjectLiteral">		</span><span class="Statement">const response </span><span class="typescriptObjectLiteral">= </span><span class="Statement">this</span><span class="Function">[<span class="typescriptComputedPropertyName">kResponse</span><span class="Function">]<span class="typescriptObjectLiteral">;
		</span><span class="Statement">if </span><span class="Normal">(<span class="PreProc">response && !this[kStopReading]</span><span class="Normal">)<span class="typescriptObjectLiteral"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Comment">// We cannot put this in the `if` above</span>
<span class="typescriptBlock">			</span><span class="Comment">// because `.read()` also triggers the `end` event</span>
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">response</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">readableLength</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kTriggerRead</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">false</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Normal">let</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">data</span><span class="typescriptBlock">;
			</span><span class="Statement">while</span><span class="typescriptBlock"> <span class="Normal">((</span><span class="typescriptParenExp">data </span><span class="typescriptAssign">=<span class="typescriptParenExp"> response</span><span class="typescriptDotNotation">.<span class="typescriptParenExp">read</span><span class="Normal">())</span><span class="typescriptLoopParen"> <span class="typescriptBinaryOp">!==</span><span class="typescriptLoopParen"> <span class="Constant">null</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kDownloadedSize</span><span class="typescriptBlock">] </span><span class="typescriptUnaryOp">+<span class="typescriptAssign">=<span class="typescriptBlock"> data</span><span class="typescriptDotNotation">.<span class="Statement">length</span><span class="typescriptBlock">;
				</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kStartedReading</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">true</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">progress</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">downloadProgress;</span>
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">progress</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">percent </span><span class="typescriptBinaryOp"><<span class="typescriptConditionalParen"> <span class="Constant">1<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">emit</span><span class="Normal">(<span class="Constant">'downloadProgress'</span><span class="typescriptFuncCallArg">, progress</span><span class="Normal">)<span class="typescriptBlock">;
				</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="Statement">push</span><span class="Normal">(<span class="typescriptFuncCallArg">data</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}
<span class="typescriptObjectLiteral">	<span class="Function">}
<span class="Normal">
	_write(</span><span class="typescriptFuncCallArg">chunk: any, encoding: string, callback: </span><span class="Normal">(<span class="PreProc">error?</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Error</span><span class="PreProc"> <span class="Operator">|<span class="PreProc"> <span class="Type">null</span><span class="Normal">)<span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Normal">void): void </span><span class="Function">{
<span class="typescriptObjectLiteral">		</span><span class="Statement">const write </span><span class="typescriptObjectLiteral">= (): </span><span class="Statement">void </span><span class="typescriptObjectLiteral">=> {
			</span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">_writeRequest</span><span class="Normal">(<span class="PreProc">chunk</span><span class="Operator">,<span class="PreProc"> encoding</span><span class="Operator">,<span class="PreProc"> callback</span><span class="Normal">)<span class="typescriptObjectLiteral">;
		</span><span class="Function">}<span class="Normal">;

		</span><span class="Statement">if</span><span class="Normal"> (</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">finalized</span><span class="Normal">) </span><span class="Function">{
<span class="typescriptBlock">			write</span><span class="Normal">()</span><span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal"> <span class="Statement">else</span><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">once</span><span class="Normal">(<span class="Constant">'finalized'</span><span class="typescriptFuncCallArg">, write</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">	}

	_writeRequest(</span><span class="typescriptFuncCallArg">chunk: any, encoding: string, callback: </span><span class="Normal">(<span class="PreProc">error?</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Error</span><span class="PreProc"> <span class="Operator">|<span class="PreProc"> <span class="Type">null</span><span class="Normal">)<span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Normal">void): void </span><span class="Function">{
<span class="typescriptObjectLiteral">		</span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">_progressCallbacks</span><span class="typescriptObjectLiteral">.<span class="Statement">push</span><span class="Normal">(<span class="PreProc">(<span class="Normal">)<span class="typescriptReturnAnnotation">: </span><span class="Type">void</span><span class="typescriptReturnAnnotation"> => </span><span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kUploadedSize</span><span class="typescriptBlock">] </span><span class="typescriptUnaryOp">+<span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">Buffer</span><span class="typescriptDotNotation">.<span class="typescriptBlock">byteLength</span><span class="Normal">(<span class="typescriptFuncCallArg">chunk, encoding </span><span class="Special">as</span><span class="typescriptFuncCallArg"> <span class="Normal">BufferEncoding)</span><span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Normal">const</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">progress</span><span class="typescriptBlock"> <span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">uploadProgress;</span>
<span class="Normal">
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">progress</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">percent </span><span class="typescriptBinaryOp"><<span class="typescriptConditionalParen"> <span class="Constant">1<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">emit</span><span class="Normal">(<span class="Constant">'uploadProgress'</span><span class="typescriptFuncCallArg">, progress</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}<span class="typescriptObjectLiteral">);</span>
<span class="Normal">
<span class="typescriptObjectLiteral">		</span><span class="Statement">this</span><span class="Function">[<span class="typescriptComputedPropertyName">kRequest</span><span class="Function">]<span class="typescriptObjectLiteral">!.</span><span class="Statement">write</span><span class="Normal">(<span class="PreProc">chunk</span><span class="Operator">,<span class="PreProc"> encoding</span><span class="Operator">,<span class="PreProc"> (error?</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Error</span><span class="PreProc"> <span class="Operator">|<span class="PreProc"> <span class="Type">null</span><span class="Normal">)<span class="typescriptObjectLiteral"> => {
			</span><span class="Statement">if </span><span class="Normal">(<span class="PreProc">!error && this._progressCallbacks.length !</span><span class="typescriptDefaultParam">==</span><span class="PreProc"> <span class="Constant">0<span class="Normal">)<span class="typescriptObjectLiteral"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_progressCallbacks</span><span class="typescriptDotNotation">.<span class="Statement">shift</span><span class="Normal">()</span><span class="typescriptUnaryOp">!<span class="Normal">()</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptObjectLiteral">			</span><span class="Statement">callback</span><span class="Normal">(<span class="PreProc">error</span><span class="Normal">)<span class="typescriptObjectLiteral">;
		</span><span class="Function">}<span class="Normal">);
	}

	_final(</span><span class="typescriptFuncCallArg">callback: </span><span class="Normal">(<span class="PreProc">error?</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Error</span><span class="PreProc"> <span class="Operator">|<span class="PreProc"> <span class="Type">null</span><span class="Normal">)<span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Normal">void): void </span><span class="Function">{
<span class="typescriptObjectLiteral">		</span><span class="Statement">const endRequest </span><span class="typescriptObjectLiteral">= (): </span><span class="Statement">void </span><span class="typescriptObjectLiteral">=> {
			</span><span class="Comment">// FIX: Node.js 10 calls the write callback AFTER the end callback!</span>
<span class="typescriptObjectLiteral">			</span><span class="Statement">while </span><span class="Normal">(<span class="PreProc">this._progressCallbacks.length !</span><span class="typescriptDefaultParam">==</span><span class="PreProc"> <span class="Constant">0<span class="Normal">)<span class="typescriptObjectLiteral"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">_progressCallbacks</span><span class="typescriptDotNotation">.<span class="Statement">shift</span><span class="Normal">()</span><span class="typescriptUnaryOp">!<span class="Normal">()</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="Normal">
<span class="typescriptObjectLiteral">			</span><span class="Comment">// We need to check if `this[kRequest]` is present,</span>
<span class="typescriptObjectLiteral">			</span><span class="Comment">// because it isn't when we use cache.</span>
<span class="typescriptObjectLiteral">			</span><span class="Statement">if </span><span class="Normal">(<span class="PreProc">!(kRequest in this</span><span class="Normal">)<span class="typescriptObjectLiteral">) {
				</span><span class="Statement">callback</span><span class="Normal">()</span><span class="typescriptObjectLiteral">;
				</span><span class="Statement">return</span><span class="typescriptObjectLiteral">;
			</span><span class="Function">}
<span class="Normal">
			</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="Normal">]<span class="typescriptUnaryOp">!<span class="typescriptDotNotation">.<span class="Normal">end((</span><span class="PreProc">error?</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Error</span><span class="PreProc"> <span class="Operator">|<span class="PreProc"> <span class="Type">null</span><span class="Normal">)<span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">error</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kBodySize</span><span class="typescriptBlock">] </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kUploadedSize</span><span class="typescriptBlock">];</span>
<span class="Normal">
<span class="typescriptBlock">					</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">emit</span><span class="Normal">(<span class="Constant">'uploadProgress'</span><span class="typescriptFuncCallArg">, </span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">uploadProgress</span><span class="Normal">)<span class="typescriptBlock">;
					</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="typescriptBlock">]<span class="typescriptUnaryOp">!<span class="typescriptBlock">.emit</span><span class="Normal">(<span class="Constant">'upload-complete'</span><span class="Normal">)<span class="typescriptBlock">;
				</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">				callback</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="Normal">)<span class="typescriptBlock">;
			</span><span class="Function">}<span class="Normal">);
		};

		</span><span class="Statement">if</span><span class="Normal"> (</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">finalized</span><span class="Normal">) </span><span class="Function">{
<span class="typescriptBlock">			endRequest</span><span class="Normal">()</span><span class="typescriptBlock">;
		</span><span class="Function">}<span class="Normal"> <span class="Statement">else</span><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptDotNotation">.<span class="typescriptBlock">once</span><span class="Normal">(<span class="Constant">'finalized'</span><span class="typescriptFuncCallArg">, endRequest</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">	}

	_destroy(</span><span class="typescriptFuncCallArg">error: </span><span class="Type">Error</span><span class="typescriptFuncCallArg"> | </span><span class="Constant">null</span><span class="typescriptFuncCallArg">, callback: </span><span class="Normal">(<span class="PreProc">error</span><span class="typescriptTypeAnnotation">:<span class="PreProc"> <span class="Normal">Error</span><span class="PreProc"> <span class="Operator">|<span class="PreProc"> <span class="Type">null</span><span class="Normal">)<span class="PreProc"> <span class="Type">=></span><span class="typescriptFuncCallArg"> <span class="Normal">void): void </span><span class="Function">{
<span class="typescriptObjectLiteral">		</span><span class="Statement">if </span><span class="Normal">(<span class="PreProc">kRequest in this</span><span class="Normal">)<span class="typescriptObjectLiteral"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Comment">// </span><span class="Todo">TODO</span><span class="Comment">: Remove the next `if` when https://github.com/nodejs/node/issues/32851 gets fixed</span>
<span class="typescriptBlock">			</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptUnaryOp">!<span class="Normal">(<span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kResponse</span><span class="typescriptParenExp">]?.complete</span><span class="Normal">))</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">				</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="typescriptBlock">]<span class="typescriptUnaryOp">!<span class="typescriptBlock">.abort</span><span class="Normal">()</span><span class="typescriptBlock">;
			</span><span class="Function">}
<span class="typescriptBlock">		</span><span class="Function">}<span class="typescriptObjectLiteral"> <span class="Statement">else </span><span class="typescriptObjectLiteral">{
			</span><span class="Statement">this</span><span class="typescriptObjectLiteral">.<span class="Statement">once</span><span class="Normal">(<span class="PreProc">'finalized'</span><span class="Operator">,<span class="PreProc"> (</span><span class="Normal">)<span class="typescriptReturnAnnotation">: </span><span class="Type">void</span><span class="typescriptReturnAnnotation"> => </span><span class="Function">{
<span class="typescriptBlock">				</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">kRequest </span><span class="Normal">in</span><span class="typescriptConditionalParen"> <span class="Type">this</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">					</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="typescriptBlock">]<span class="typescriptUnaryOp">!<span class="typescriptBlock">.abort</span><span class="Normal">()</span><span class="typescriptBlock">;
				</span><span class="Function">}
<span class="typescriptBlock">			</span><span class="Function">}<span class="typescriptObjectLiteral">);
		</span><span class="Function">}
<span class="Normal">
		</span><span class="Statement">if</span><span class="Normal"> (</span><span class="typescriptConditionalParen">error </span><span class="typescriptBinaryOp">!==</span><span class="typescriptConditionalParen"> <span class="Constant">null</span><span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> <span class="typescriptUnaryOp">!<span class="typescriptConditionalParen">is</span><span class="typescriptDotNotation">.<span class="typescriptConditionalParen">undefined</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="Normal">)<span class="typescriptConditionalParen"> <span class="typescriptBinaryOp">&&</span><span class="typescriptConditionalParen"> <span class="typescriptUnaryOp">!<span class="Normal">(<span class="typescriptParenExp">error </span><span class="Normal">instanceof</span><span class="typescriptParenExp"> RequestError</span><span class="Normal">)) </span><span class="Function">{
<span class="typescriptBlock">			error </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> RequestError</span><span class="Normal">(<span class="typescriptFuncCallArg">error</span><span class="typescriptDotNotation">.<span class="typescriptFuncCallArg">message, error, </span><span class="Type">this</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
		callback(</span><span class="typescriptFuncCallArg">error</span><span class="Normal">);
	}

	get ip(): string </span><span class="typescriptBinaryOp">|<span class="Normal"> <span class="Constant">undefined</span><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Statement">return</span><span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="typescriptBlock">]?.socket</span><span class="typescriptDotNotation">.<span class="typescriptBlock">remoteAddress;
	</span><span class="Function">}
<span class="Normal">
	get aborted(): boolean </span><span class="Function">{
<span class="typescriptBlock">		</span><span class="Statement">return</span><span class="typescriptBlock"> <span class="Type">Boolean</span><span class="Normal">(<span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="typescriptParenExp">]?.aborted</span><span class="Normal">)<span class="typescriptBlock">;
	</span><span class="Function">}
<span class="Normal">
	get socket(): Socket </span><span class="typescriptBinaryOp">|<span class="Normal"> <span class="Constant">undefined</span><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Statement">return</span><span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="typescriptBlock">]?.socket;
	</span><span class="Function">}
<span class="Normal">
	get downloadProgress(): Progress </span><span class="Function">{
<span class="typescriptBlock">		</span><span class="Normal">let</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">percent</span><span class="typescriptBlock">;
		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kResponseSize</span><span class="typescriptConditionalParen">]<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			percent </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kDownloadedSize</span><span class="typescriptBlock">] / </span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kResponseSize</span><span class="typescriptBlock">]<span class="typescriptUnaryOp">!<span class="typescriptBlock">;
		</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kResponseSize</span><span class="typescriptConditionalParen">] === </span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kDownloadedSize</span><span class="typescriptConditionalParen">]<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			percent </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">1<span class="typescriptBlock">;
		</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			percent </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">0<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">return</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">percent</span><span class="typescriptObjectLiteral">,
			</span><span class="Statement">transferred</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kDownloadedSize</span><span class="typescriptObjectLiteral">],
			</span><span class="Statement">total</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kResponseSize</span><span class="typescriptObjectLiteral">]
		</span><span class="Function">}<span class="typescriptBlock">;
	</span><span class="Function">}
<span class="Normal">
	get uploadProgress(): Progress </span><span class="Function">{
<span class="typescriptBlock">		</span><span class="Normal">let</span><span class="typescriptBlock"> <span class="typescriptVariableDeclaration">percent</span><span class="typescriptBlock">;
		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kBodySize</span><span class="typescriptConditionalParen">]<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			percent </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kUploadedSize</span><span class="typescriptBlock">] / </span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kBodySize</span><span class="typescriptBlock">]<span class="typescriptUnaryOp">!<span class="typescriptBlock">;
		</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kBodySize</span><span class="typescriptConditionalParen">] === </span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kUploadedSize</span><span class="typescriptConditionalParen">]<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			percent </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">1<span class="typescriptBlock">;
		</span><span class="Function">}<span class="typescriptBlock"> <span class="Statement">else</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			percent </span><span class="typescriptAssign">=<span class="typescriptBlock"> <span class="Constant">0<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">return</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptObjectLiteral">			</span><span class="Statement">percent</span><span class="typescriptObjectLiteral">,
			</span><span class="Statement">transferred</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kUploadedSize</span><span class="typescriptObjectLiteral">],
			</span><span class="Statement">total</span><span class="typescriptObjectColon">:<span class="typescriptObjectLiteral"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kBodySize</span><span class="typescriptObjectLiteral">]
		</span><span class="Function">}<span class="typescriptBlock">;
	</span><span class="Function">}
<span class="Normal">
	get timings(): Timings </span><span class="typescriptBinaryOp">|<span class="Normal"> <span class="Constant">undefined</span><span class="Normal"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Statement">return</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kRequest</span><span class="typescriptParenExp">] </span><span class="Special">as</span><span class="typescriptParenExp"> <span class="Normal">ClientRequestWithTimings)</span><span class="typescriptTernaryOp">?<span class="typescriptTernary">.timings;
	}</span>
<span class="Normal">
<span class="typescriptTernary">	get isFromCache</span><span class="Normal">()</span><span class="typescriptTernaryOp">:<span class="typescriptBlock"> boolean </span><span class="typescriptBinaryOp">|<span class="typescriptBlock"> <span class="Constant">undefined</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Statement">return</span><span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kIsFromCache</span><span class="typescriptBlock">];
	</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">	pipe</span><span class="typescriptTypeBrackets"><<span class="Normal">T<span class="typescriptTypeArguments"> <span class="Normal">extends</span><span class="typescriptTypeArguments"> <span class="Normal">NodeJS.WritableStream</span><span class="typescriptTypeBrackets">><span class="Normal">(<span class="typescriptFuncCallArg">destination: T, options</span><span class="typescriptTernaryOp">?:</span><span class="typescriptFuncCallArg"> <span class="Function">{<span class="Statement">end</span><span class="typescriptObjectLiteral">?: </span><span class="Statement">boolean</span><span class="Function">}<span class="Normal">)<span class="typescriptBlock">: T </span><span class="Function">{
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kStartedReading</span><span class="typescriptConditionalParen">]<span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Special">throw</span><span class="typescriptBlock"> <span class="Normal">new</span><span class="typescriptBlock"> <span class="Type">Error</span><span class="Normal">(<span class="Constant">'Failed to pipe. The response has been emitted already.'</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">destination </span><span class="Normal">instanceof</span><span class="typescriptConditionalParen"> ServerResponse</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kServerResponsesPiped</span><span class="typescriptBlock">].add</span><span class="Normal">(<span class="typescriptFuncCallArg">destination</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">return</span><span class="typescriptBlock"> <span class="Type">super</span><span class="typescriptDotNotation">.<span class="typescriptBlock">pipe</span><span class="Normal">(<span class="typescriptFuncCallArg">destination, options</span><span class="Normal">)<span class="typescriptBlock">;
	</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">	unpipe</span><span class="typescriptTypeBrackets"><<span class="Normal">T<span class="typescriptTypeArguments"> <span class="Normal">extends</span><span class="typescriptTypeArguments"> <span class="Normal">NodeJS.WritableStream</span><span class="typescriptTypeBrackets">><span class="Normal">(<span class="typescriptFuncCallArg">destination: T</span><span class="Normal">)<span class="typescriptBlock">: </span><span class="Type">this</span><span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">		</span><span class="Statement">if</span><span class="typescriptBlock"> <span class="Normal">(<span class="typescriptConditionalParen">destination </span><span class="Normal">instanceof</span><span class="typescriptConditionalParen"> ServerResponse</span><span class="Normal">)<span class="typescriptBlock"> <span class="Function">{
<span class="typescriptBlock">			</span><span class="Type">this</span><span class="typescriptProperty">[<span class="typescriptIndexExpr">kServerResponsesPiped</span><span class="typescriptBlock">].</span><span class="Normal">delete(</span><span class="typescriptParenExp">destination</span><span class="Normal">)<span class="typescriptBlock">;
		</span><span class="Function">}
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Type">super</span><span class="typescriptDotNotation">.<span class="typescriptBlock">unpipe</span><span class="Normal">(<span class="typescriptFuncCallArg">destination</span><span class="Normal">)<span class="typescriptBlock">;
<span class="Normal">
<span class="typescriptBlock">		</span><span class="Statement">return</span><span class="typescriptBlock"> <span class="Type">this</span><span class="typescriptBlock">;
	</span><span class="Function">}
}</span>